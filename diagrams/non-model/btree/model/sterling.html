<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Zoomable Image</title>
    <style>
        #svg-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #zoomable-image {
            width: 100%;
            height: auto;
        }

        .svg-border {
            border: 2px solid black;
        }
    </style>
    <!-- Include D3.js library -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>

    <div class="container">


        <div class="container-fluid" id="svg-container">
            <svg id="diagram" width="800" height="800" class="svg-border">
                <g class="zoomable">
                    <g
                        transform="matrix(0.6515988706674123,0,0,0.6515988706674123,-8.517244976616894,7.3535891000473494)">
                        <g id="">
                            <defs>
                                <marker id="arrow-10-[#333]" viewBox="0 0 10 10" refX="0" refY="5" markerWidth="10"
                                    markerHeight="10" markerUnits="userSpaceOnUse" orient="auto" fill="#333">
                                    <path d="M 0 0 L 10 5 L 0 10 z"></path>
                                </marker>
                            </defs>
                            <g class="nodes">
                                <g id="Node0" transform="translate(0 -400)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(255, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node0</text>
                                </g>
                                <g id="Node1" transform="translate(0 80)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(255, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node1</text>
                                </g>
                                <g id="Node2" transform="translate(-200 400)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(255, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node2</text>
                                </g>
                                <g id="Node3" transform="translate(200 80)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(255, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node3</text>
                                </g>
                                <g id="Node4" transform="translate(200 -80)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(255, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node4</text>
                                </g>
                                <g id="Node5" transform="translate(-200 240)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(255, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node5</text>
                                </g>
                                <g id="Node6" transform="translate(-100 -80)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(255, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node6</text>
                                </g>
                                <g id="Node7" transform="translate(0 -240)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(255, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node7</text>
                                </g>
                                <g id="Node8" transform="translate(-200 80)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(255, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node8</text>
                                </g>
                            </g>
                            <g class="edges">
                                <g id="Node<:parent:Node0->Node7">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-3.75,-370L-4.791666666666667,-361.6666666666667C-5.833333333333333,-353.3333333333333,-7.916666666666667,-336.6666666666667,-8.123311201731363,-321.65380859375C-8.32995573679606,-306.6409505208333,-6.659911473592122,-293.2819010416667,-5.824889341990153,-286.6023763020833L-4.989867210388184,-279.9228515625">
                                    </path>
                                    <path
                                        d="M-3.75,-370L-4.791666666666667,-361.6666666666667C-5.833333333333333,-353.3333333333333,-7.916666666666667,-336.6666666666667,-7.9166666666666705,-320C-7.916666666666674,-303.3333333333333,-5.833333333333347,-286.6666666666667,-4.791666666666685,-278.3333333333333L-3.7500000000000213,-270"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-7.916666507720947" y="-320" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node1->Node6">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M33.749999999999986,50L43.12499999999999,41.666666666666664C52.49999999999999,33.333333333333336,71.25,16.666666666666668,58.82772572835287,-0.8444665273030599C46.40545145670573,-18.355599721272785,2.8109029134114585,-36.71119944254557,-18.986371358235676,-45.88899930318197L-40.78364562988281,-55.06679916381836">
                                    </path>
                                    <path
                                        d="M33.749999999999986,50L43.12499999999999,41.666666666666664C52.49999999999999,33.333333333333336,71.25,16.666666666666668,57.291666666666664,-1.4912280701754408C43.333333333333336,-19.649122807017548,-3.3333333333333335,-39.298245614035096,-26.666666666666668,-49.12280701754387L-50,-58.947368421052644"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="34.363285064697266" y="-19.81348419189453" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node2->Node5">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-196.25,370L-195.20833333333334,361.6666666666667C-194.16666666666666,353.3333333333333,-192.08333333333334,336.6666666666667,-191.8766886393229,321.65380859375C-191.6700439453125,306.6409505208333,-193.340087890625,293.2819010416667,-194.17510986328125,286.6023763020833L-195.0101318359375,279.9228515625">
                                    </path>
                                    <path
                                        d="M-196.25,370L-195.20833333333334,361.6666666666667C-194.16666666666666,353.3333333333333,-192.08333333333334,336.6666666666667,-192.08333333333334,320C-192.08333333333334,303.3333333333333,-194.16666666666666,286.6666666666667,-195.20833333333334,278.3333333333333L-196.25,270"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-192.0833282470703" y="320" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node3->Node4">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M203.75,50L204.79166666666666,41.666666666666664C205.83333333333334,33.333333333333336,207.91666666666666,16.666666666666668,208.1233113606771,1.6538060506184895C208.3299560546875,-13.359054565429688,206.659912109375,-26.718109130859375,205.82489013671875,-33.39763641357422L204.9898681640625,-40.07716369628906">
                                    </path>
                                    <path
                                        d="M203.75,50L204.79166666666666,41.666666666666664C205.83333333333334,33.333333333333336,207.91666666666666,16.666666666666668,207.91666666666666,0C207.91666666666666,-16.666666666666668,205.83333333333334,-33.333333333333336,204.79166666666666,-41.666666666666664L203.75,-50"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="207.9166717529297" y="-0.000003933906555175781" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node4->Node7">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M207.5,-110L209.58333333333334,-118.33333333333333C211.66666666666666,-126.66666666666667,215.83333333333334,-143.33333333333334,191.1496556599935,-161.4001235961914C166.46597798665366,-179.46691385904947,112.9319559733073,-198.93382771809897,86.16494496663411,-208.6672846476237L59.39793395996094,-218.40074157714844">
                                    </path>
                                    <path
                                        d="M207.5,-110L209.58333333333334,-118.33333333333333C211.66666666666666,-126.66666666666667,215.83333333333334,-143.33333333333334,189.58333333333334,-161.96969696969697C163.33333333333334,-180.60606060606062,106.66666666666667,-201.21212121212125,78.33333333333333,-211.51515151515153L50,-221.81818181818184"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="149.17416381835938" y="-183.63311767578125" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node6->Node8">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-145,-50L-157.5,-41.666666666666664C-170,-33.333333333333336,-195,-16.666666666666668,-205.82054901123047,-1.6169891357421875C-216.64109802246094,13.432688395182291,-213.28219604492188,26.865376790364582,-211.60274505615234,33.58172098795573L-209.9232940673828,40.298065185546875">
                                    </path>
                                    <path
                                        d="M-145,-50L-157.5,-41.666666666666664C-170,-33.333333333333336,-195,-16.666666666666668,-205.41666666666666,0C-215.83333333333334,16.666666666666668,-211.66666666666666,33.333333333333336,-209.58333333333334,41.666666666666664L-207.5,50"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-196.98667907714844" y="-10.622824668884277" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node7->Node6">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-45.000000000000014,-210L-57.50000000000001,-201.66666666666666C-70.00000000000001,-193.33333333333334,-95,-176.66666666666666,-105.82055155436198,-161.6169891357422C-116.64110310872395,-146.56731160481772,-113.28220621744792,-133.1346232096354,-111.60275777180989,-126.41827901204427L-109.92330932617188,-119.70193481445312">
                                    </path>
                                    <path
                                        d="M-45.000000000000014,-210L-57.50000000000001,-201.66666666666666C-70.00000000000001,-193.33333333333334,-95,-176.66666666666666,-105.41666666666667,-160C-115.83333333333333,-143.33333333333334,-111.66666666666667,-126.66666666666667,-109.58333333333333,-118.33333333333333L-107.5,-110"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-96.98667907714844" y="-170.62281799316406" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node8->Node5">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-203.75,110L-204.79166666666666,118.33333333333333C-205.83333333333334,126.66666666666667,-207.91666666666666,143.33333333333334,-208.1233113606771,158.3461939493815C-208.3299560546875,173.3590545654297,-206.659912109375,186.71810913085938,-205.82489013671875,193.39763641357422L-204.9898681640625,200.07716369628906">
                                    </path>
                                    <path
                                        d="M-203.75,110L-204.79166666666666,118.33333333333333C-205.83333333333334,126.66666666666667,-207.91666666666666,143.33333333333334,-207.91666666666666,160C-207.91666666666666,176.66666666666666,-205.83333333333334,193.33333333333334,-204.79166666666666,201.66666666666666L-203.75,210"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-207.9166717529297" y="160" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:children:Node4->Node3">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M166.25,-50L156.875,-41.666666666666664C147.5,-33.333333333333336,128.75,-16.666666666666668,127.50431823730469,-1.1072731018066406C126.25863647460938,14.452120463053385,142.51727294921875,28.90424092610677,150.64659118652344,36.13030115763346L158.77590942382812,43.356361389160156">
                                    </path>
                                    <path
                                        d="M166.25,-50L156.875,-41.666666666666664C147.5,-33.333333333333336,128.75,-16.666666666666668,128.75,0C128.75,16.666666666666668,147.49999999999997,33.333333333333336,156.87499999999997,41.666666666666664L166.24999999999997,50"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="128.75"
                                        y="-0.0000076293763413559645" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node5->Node2">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-203.75,270L-204.79166666666666,278.3333333333333C-205.83333333333334,286.6666666666667,-207.91666666666666,303.3333333333333,-208.1233113606771,318.34619140625C-208.3299560546875,333.3590494791667,-206.659912109375,346.7180989583333,-205.82489013671875,353.3976236979167L-204.9898681640625,360.0771484375">
                                    </path>
                                    <path
                                        d="M-203.75,270L-204.79166666666666,278.3333333333333C-205.83333333333334,286.6666666666667,-207.91666666666666,303.3333333333333,-207.91666666666666,320C-207.91666666666666,336.6666666666667,-205.83333333333334,353.3333333333333,-204.79166666666666,361.6666666666667L-203.75000000000003,370"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-207.9166717529297" y="320" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node5->Node8">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-196.25,210L-195.20833333333334,201.66666666666666C-194.16666666666666,193.33333333333334,-192.08333333333334,176.66666666666666,-191.8766886393229,161.65380732218424C-191.6700439453125,146.6409479777018,-193.340087890625,133.28189595540366,-194.17510986328125,126.60236994425456L-195.0101318359375,119.92284393310547">
                                    </path>
                                    <path
                                        d="M-196.25,210L-195.20833333333334,201.66666666666666C-194.16666666666666,193.33333333333334,-192.08333333333334,176.66666666666666,-192.08333333333334,160C-192.08333333333334,143.33333333333334,-194.16666666666666,126.66666666666667,-195.20833333333334,118.33333333333333L-196.25,110"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-192.0833282470703" y="160" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node6->Node1">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-103.75,-50L-104.79166666666667,-41.666666666666664C-105.83333333333333,-33.333333333333336,-107.91666666666667,-16.666666666666668,-98.84789339701335,-0.9802862803141276C-89.77912012736003,14.706094106038412,-69.55824025472005,29.412188212076824,-59.44780031840006,36.76523526509603L-49.33736038208008,44.118282318115234">
                                    </path>
                                    <path
                                        d="M-103.75,-50L-104.79166666666667,-41.666666666666664C-105.83333333333333,-33.333333333333336,-107.91666666666667,-16.666666666666668,-97.5,0C-87.08333333333333,16.666666666666668,-64.16666666666667,33.333333333333336,-52.708333333333336,41.666666666666664L-41.25,50"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-90.25431060791016" y="9.57840633392334" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node6->Node7">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-50,-99.04761904761907L-23.333333333333332,-109.20634920634922C3.3333333333333335,-119.36507936507938,56.666666666666664,-139.68253968253967,73.22289403279622,-157.1943175300719C89.77912139892578,-174.70609537760416,69.55824279785156,-189.41219075520834,59.44780349731445,-196.7652384440104L49.337364196777344,-204.1182861328125">
                                    </path>
                                    <path
                                        d="M-50,-99.04761904761907L-23.333333333333332,-109.20634920634922C3.3333333333333335,-119.36507936507938,56.666666666666664,-139.68253968253967,71.875,-158.17460317460316C87.08333333333333,-176.66666666666666,64.16666666666666,-193.33333333333334,52.70833333333332,-201.66666666666666L41.249999999999986,-210"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="44.54047775268555" y="-138.52944946289062" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node7->Node0">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M3.75,-270L4.791666666666667,-278.3333333333333C5.833333333333333,-286.6666666666667,7.916666666666667,-303.3333333333333,8.123311201731363,-318.34619140625C8.32995573679606,-333.3590494791667,6.659911473592122,-346.7180989583333,5.824889341990153,-353.3976236979167L4.989867210388184,-360.0771484375">
                                    </path>
                                    <path
                                        d="M3.75,-270L4.791666666666667,-278.3333333333333C5.833333333333333,-286.6666666666667,7.916666666666667,-303.3333333333333,7.916666666666668,-320C7.916666666666669,-336.6666666666667,5.833333333333338,-353.3333333333333,4.791666666666672,-361.6666666666667L3.750000000000007,-370"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="7.916666507720947" y="-320" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node7->Node4">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M33.750000000000014,-210L43.12500000000001,-201.66666666666666C52.50000000000001,-193.33333333333334,71.25,-176.66666666666666,90.73544057210286,-160.98028691609701C110.22088114420573,-145.29390716552734,130.44176228841147,-130.5878143310547,140.5522028605143,-123.23476791381836L150.6626434326172,-115.88172149658203">
                                    </path>
                                    <path
                                        d="M33.750000000000014,-210L43.12500000000001,-201.66666666666666C52.50000000000001,-193.33333333333334,71.25,-176.66666666666666,92.08333333333333,-160C112.91666666666667,-143.33333333333334,135.83333333333334,-126.66666666666667,147.29166666666666,-118.33333333333333L158.75,-110"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="94.62590789794922" y="-157.97425842285156" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node8->Node6">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-150,57.777777777777764L-128.33333333333334,48.14814814814813C-106.66666666666667,38.51851851851851,-63.333333333333336,19.259259259259256,-48.82148869832357,2.474807597972726C-34.309644063313804,-14.309644063313803,-48.6192881266276,-28.619288126627605,-55.77411015828451,-35.77411015828451L-62.928932189941406,-42.928932189941406">
                                    </path>
                                    <path
                                        d="M-150,57.777777777777764L-128.33333333333334,48.14814814814813C-106.66666666666667,38.51851851851851,-63.333333333333336,19.259259259259256,-50,1.296296296296294C-36.666666666666664,-16.666666666666668,-53.333333333333336,-33.333333333333336,-61.666666666666664,-41.666666666666664L-70,-50"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-70.6850357055664" y="18.81516456604004" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                            </g>
                        </g>
                    </g>
                </g>
            </svg>
        </div>
    </div>
    <script>
        // Add zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 10]) // Set the zoom scale extent
            .on('zoom', zoomed);

        function zoomed(event) {
            d3.select('.zoomable').attr('transform', event.transform);
        }
        const diagram = d3.select('#diagram');
        diagram.call(zoom);


        // Select all nodes and make them draggable
        const nodes = d3.selectAll('.nodes g');

        function getNodePositions() {
            const positions = {};
            nodes.each(function () {
                const node = d3.select(this);
                const transform = node.attr('transform');
                const translate = transform.match(/translate\(([^, ]+)[, ]+([^)]+)\)/);
                if (translate) {
                    const x = parseFloat(translate[1]);
                    const y = parseFloat(translate[2]);
                    positions[node.attr('id')] = { x, y };
                }
            });
            console.log(positions);
            return positions;
        }

        // Store the initial positions of the nodes
        const nodePositions = getNodePositions();

        function getEdgeSourceAndTarget(edgeId) {
            // First find the id of the last : character and get the substring after it
            const byParts = edgeId.split(':');
            let rel = byParts[byParts.length - 1];

            const [sourceId, targetId] = rel.split('->');
            return { sourceId, targetId };
        }

        function updatePath(path, startX, startY, endX, endY) {
            const controlPoint1 = `${(startX + endX) / 2},${startY}`;
            const controlPoint2 = `${(startX + endX) / 2},${endY}`;
            const newD = `M${startX},${startY} C${controlPoint1},${controlPoint2},${endX},${endY}`;
            path.attr('d', newD);
        }

        function getIntersectionPoint(node, targetNode) {
            const dx = targetNode.x - node.x;
            const dy = targetNode.y - node.y;
            const absDx = Math.abs(dx);
            const absDy = Math.abs(dy);

            let x = node.x;
            let y = node.y;

            const halfWidth = 50;
            const halfHeight = 30;

            if (absDx > absDy) {
                x += dx > 0 ? halfWidth : -halfWidth;
                y += dy * (halfWidth / absDx);
            } else {
                x += dx * (halfHeight / absDy);
                y += dy > 0 ? halfHeight : -halfHeight;
            }

            return { x, y };
        }

        function updateEdges(nodeId) {
            const node = nodePositions[nodeId];
            // Update edges where the node is the source
            d3.selectAll(`g[id*=":${nodeId}->"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (sourceId === nodeId);

                const targetNode = nodePositions[targetId];
                const sourceIntersection = getIntersectionPoint(node, targetNode);
                const targetIntersection = getIntersectionPoint(targetNode, node);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });

            // Update edges where the node is the target
            d3.selectAll(`g[id*="->${nodeId}"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (targetId === nodeId);

                const sourceNode = nodePositions[sourceId];
                const sourceIntersection = getIntersectionPoint(sourceNode, node);
                const targetIntersection = getIntersectionPoint(node, sourceNode);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });
        }

        nodes
            .call(d3.drag()
                .on('start', dragStarted)
                .on('drag', dragged)
                .on('end', dragEnded));

        function dragStarted(event, d) {
            d3.select(this).raise().attr('stroke', 'black');
        }

        function dragged(event, d) {
            const nodeId = d3.select(this).attr('id');
            nodePositions[nodeId].x = event.x;
            nodePositions[nodeId].y = event.y;
            d3.select(this).attr('transform', `translate(${event.x}, ${event.y})`);
            updateEdges(nodeId); // Update the edges during the drag event
        }

        function dragEnded(event, d) {
            d3.select(this).attr('stroke', null);
        }



        /**** This bit ensures we zoom to fit ***/
        const bbox = d3.select('.zoomable').node().getBBox();
        const padding = 10; // Padding in pixels

        const viewBox = [
            bbox.x - padding,
            bbox.y - padding,
            bbox.width + 2 * padding,
            bbox.height + 2 * padding
        ].join(' ');


        const topSvg = d3.select("#diagram");
        topSvg.attr('viewBox', viewBox);
        /*************************************/

    </script>
</body>

</html>