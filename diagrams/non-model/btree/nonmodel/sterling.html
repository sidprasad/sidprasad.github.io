<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Zoomable Image</title>
    <style>
        #svg-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #zoomable-image {
            width: 100%;
            height: auto;
        }

        .svg-border {
            border: 2px solid black;
        }
    </style>
    <!-- Include D3.js library -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>

    <div class="container">


        <div class="container-fluid" id="svg-container">
            <svg id="diagram" width="800" height="800" class="svg-border">
                <g class="zoomable">

                    <g transform="matrix(1,0,0,1,0,0)">
                        <g id="">
                            <defs>
                                <marker id="arrow-10-[#333]" viewBox="0 0 10 10" refX="0" refY="5" markerWidth="10"
                                    markerHeight="10" markerUnits="userSpaceOnUse" orient="auto" fill="#333">
                                    <path d="M 0 0 L 10 5 L 0 10 z"></path>
                                </marker>
                            </defs>
                            <g class="nodes">
                                <g id="Node0" transform="translate(0 -320)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(235, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node0</text>
                                </g>
                                <g id="Node1" transform="translate(-200 160)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(235, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node1</text>
                                </g>
                                <g id="Node2" transform="translate(-100 320)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(235, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node2</text>
                                </g>
                                <g id="Node3" transform="translate(200 160)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(235, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node3</text>
                                </g>
                                <g id="Node4" transform="translate(220 -87)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(235, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node4</text>
                                </g>
                                <g id="Node5" transform="translate(0 160)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(235, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node5</text>
                                </g>
                                <g id="Node6" transform="translate(-100 0)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(235, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node6</text>
                                </g>
                                <g id="Node7" transform="translate(0 -160)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(235, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node7</text>
                                </g>
                                <g id="Node8" transform="translate(100 320)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(235, 0, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Node8</text>
                                </g>
                            </g>
                            <g class="edges">
                                <g id="Node<:parent:Node0->Node7">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-3.75,-290L-4.791666666666667,-281.6666666666667C-5.833333333333333,-273.3333333333333,-7.916666666666667,-256.6666666666667,-8.123311201731363,-241.6538060506185C-8.32995573679606,-226.6409454345703,-6.659911473592122,-213.28189086914062,-5.824889341990153,-206.60236358642578L-4.989867210388184,-199.92283630371094">
                                    </path>
                                    <path
                                        d="M-3.75,-290L-4.791666666666667,-281.6666666666667C-5.833333333333333,-273.3333333333333,-7.916666666666667,-256.6666666666667,-7.9166666666666705,-240C-7.916666666666674,-223.33333333333334,-5.833333333333347,-206.66666666666666,-4.791666666666685,-198.33333333333334L-3.7500000000000213,-190"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-7.916666507720947" y="-240" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node1->Node6">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-150,137.77777777777777L-128.33333333333334,128.14814814814815C-106.66666666666667,118.51851851851852,-63.333333333333336,99.25925925925925,-48.82148869832357,82.47480759797273C-34.309644063313804,65.6903559366862,-48.6192881266276,51.3807118733724,-55.77411015828451,44.22588984171549L-62.928932189941406,37.071067810058594">
                                    </path>
                                    <path
                                        d="M-150,137.77777777777777L-128.33333333333334,128.14814814814815C-106.66666666666667,118.51851851851852,-63.333333333333336,99.25925925925925,-50,81.29629629629629C-36.666666666666664,63.333333333333336,-53.333333333333336,46.666666666666664,-61.666666666666664,38.333333333333336L-70,30"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-70.68504333496094" y="98.8151626586914" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node2->Node5">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-58.75000000000003,290L-47.291666666666686,281.6666666666667C-35.83333333333335,273.3333333333333,-12.916666666666677,256.6666666666667,-2.2937410672505743,241.6538543701172C8.329184532165527,226.64104207356772,6.658369064331055,213.2820841471354,5.822961330413818,206.60260518391928L4.987553596496582,199.92312622070312">
                                    </path>
                                    <path
                                        d="M-58.75000000000003,290L-47.291666666666686,281.6666666666667C-35.83333333333335,273.3333333333333,-12.916666666666677,256.6666666666667,-2.5000000000000036,240C7.916666666666669,223.33333333333334,5.833333333333338,206.66666666666666,4.791666666666672,198.33333333333334L3.750000000000007,190"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-9.74586009979248" y="249.57826232910156" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node3->Node4">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M203.75,130L204.79166666666666,121.66666666666667C205.83333333333334,113.33333333333333,207.91666666666666,96.66666666666667,210.2259775797526,67.16368675231934C212.53528849283853,37.66070683797201,215.0705769856771,-4.678586324055989,216.33822123209634,-25.848232905069988L217.60586547851562,-47.017879486083984">
                                    </path>
                                    <path
                                        d="M203.75,130L204.79166666666666,121.66666666666667C205.83333333333334,113.33333333333333,207.91666666666666,96.66666666666667,210.3255988023952,65.5C212.73453093812375,34.333333333333336,215.46906187624754,-11.333333333333334,216.8363273453094,-34.166666666666664L218.20359281437126,-57"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="212.39599609375" y="36.6182746887207" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node4->Node7">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M220,-57L220,-60.833333333333336C220,-64.66666666666667,220,-72.33333333333333,193.2329889933268,-85.9001235961914C166.46597798665366,-99.46691385904948,112.9319559733073,-118.93382771809895,86.16494496663411,-128.6672846476237L59.39793395996094,-138.40074157714844">
                                    </path>
                                    <path
                                        d="M220,-57L220,-60.833333333333336C220,-64.66666666666667,220,-72.33333333333333,191.66666666666666,-86.46969696969698C163.33333333333334,-100.60606060606062,106.66666666666667,-121.21212121212123,78.33333333333333,-131.51515151515153L50,-141.81818181818184"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="141.84776306152344" y="-107.76758575439453" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node5->Node6">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M33.749999999999986,130L43.12499999999999,121.66666666666667C52.49999999999999,113.33333333333333,71.25,96.66666666666667,58.82772572835287,79.15553379058838C46.40545145670573,61.64440091451009,2.8109029134114585,43.28880182902018,-18.986371358235676,34.11100228627523L-40.78364562988281,24.933202743530273">
                                    </path>
                                    <path
                                        d="M33.749999999999986,130L43.12499999999999,121.66666666666667C52.49999999999999,113.33333333333333,71.25,96.66666666666667,57.291666666666664,78.50877192982456C43.333333333333336,60.350877192982445,-3.3333333333333335,40.701754385964904,-26.666666666666668,30.877192982456126L-50,21.052631578947356"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="34.3632926940918" y="60.1865234375" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node7->Node6">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-45,-130L-57.5,-121.66666666666667C-70,-113.33333333333333,-95,-96.66666666666667,-105.82055155436198,-81.61698913574219C-116.64110310872395,-66.5673116048177,-113.28220621744792,-53.134623209635414,-111.60275777180989,-46.41827901204427L-109.92330932617188,-39.701934814453125">
                                    </path>
                                    <path
                                        d="M-45,-130L-57.5,-121.66666666666667C-70,-113.33333333333333,-95,-96.66666666666667,-105.41666666666667,-80C-115.83333333333333,-63.333333333333336,-111.66666666666667,-46.666666666666664,-109.58333333333333,-38.333333333333336L-107.5,-30"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-96.98667907714844" y="-90.62283325195312" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:parent:Node8->Node5">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M107.5,290L109.58333333333333,281.6666666666667C111.66666666666667,273.3333333333333,115.83333333333333,256.6666666666667,106.80341720581055,240.92449951171875C97.77350107828777,225.18233235677084,75.54700215657552,210.36466471354166,64.4337526957194,202.9558308919271L53.32050323486328,195.5469970703125">
                                    </path>
                                    <path
                                        d="M107.5,290L109.58333333333333,281.6666666666667C111.66666666666667,273.3333333333333,115.83333333333333,256.6666666666667,105.41666666666667,240C95,223.33333333333334,70.00000000000001,206.66666666666666,57.50000000000001,198.33333333333334L45.000000000000014,190"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="96.98667907714844" y="229.37716674804688" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parent</text>
                                </g>
                                <g id="Node<:children:Node4->Node3">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M200.23952095808383,-57L185.19960079840317,-34.166666666666664C170.15968063872256,-11.333333333333334,140.0798403193613,34.333333333333336,133.16923839698532,64.39272689819336C126.25863647460938,94.45212046305339,142.51727294921875,108.90424092610677,150.64659118652344,116.13030115763347L158.77590942382812,123.35636138916016">
                                    </path>
                                    <path
                                        d="M200.23952095808383,-57L185.19960079840317,-34.166666666666664C170.15968063872256,-11.333333333333334,140.0798403193613,34.333333333333336,134.41492015968063,65.5C128.75,96.66666666666667,147.49999999999997,113.33333333333333,156.87499999999997,121.66666666666667L166.24999999999997,130"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="144.59527587890625" y="35.51780319213867" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node5->Node2">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-45.000000000000014,190L-57.50000000000001,198.33333333333334C-70.00000000000001,206.66666666666666,-95,223.33333333333334,-105.82050069173177,238.38299560546875C-116.64100138346355,253.43265787760416,-113.28200276692708,266.8653157552083,-111.60250345865886,273.58164469401044L-109.92300415039062,280.2979736328125">
                                    </path>
                                    <path
                                        d="M-45.000000000000014,190L-57.50000000000001,198.33333333333334C-70.00000000000001,206.66666666666666,-95,223.33333333333334,-105.41666666666667,240C-115.83333333333333,256.6666666666667,-111.66666666666667,273.3333333333333,-109.58333333333333,281.6666666666667L-107.5,290"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-96.98668670654297" y="229.37718200683594" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node5->Node8">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-3.75,190L-4.791666666666667,198.33333333333334C-5.833333333333333,206.66666666666666,-7.916666666666667,223.33333333333334,1.1521072387695312,239.01971435546875C10.220881144205729,254.70609537760416,30.441762288411457,269.4121907552083,40.55220286051432,276.76523844401044L50.66264343261719,284.1182861328125">
                                    </path>
                                    <path
                                        d="M-3.75,190L-4.791666666666667,198.33333333333334C-5.833333333333333,206.66666666666666,-7.916666666666667,223.33333333333334,2.499999999999998,240C12.916666666666663,256.6666666666667,35.83333333333332,273.3333333333333,47.29166666666666,281.6666666666667L58.749999999999986,290"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="9.745854377746582" y="249.57826232910156" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node6->Node1">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-145,30L-157.5,38.333333333333336C-170,46.666666666666664,-195,63.333333333333336,-205.82054901123047,78.38301086425781C-216.64109802246094,93.4326883951823,-213.28219604492188,106.86537679036458,-211.60274505615234,113.58172098795573L-209.9232940673828,120.29806518554688">
                                    </path>
                                    <path
                                        d="M-145,30L-157.5,38.333333333333336C-170,46.666666666666664,-195,63.333333333333336,-205.41666666666666,80C-215.83333333333334,96.66666666666667,-211.66666666666666,113.33333333333333,-209.58333333333334,121.66666666666667L-207.5,130"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-196.98666381835938" y="69.37716674804688" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node6->Node5">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-103.75,30L-104.79166666666667,38.333333333333336C-105.83333333333333,46.666666666666664,-107.91666666666667,63.333333333333336,-98.84789339701335,79.019713083903C-89.77912012736003,94.70609283447266,-69.55824025472005,109.41218566894531,-59.44780031840006,116.76523208618164L-49.33736038208008,124.11827850341797">
                                    </path>
                                    <path
                                        d="M-103.75,30L-104.79166666666667,38.333333333333336C-105.83333333333333,46.666666666666664,-107.91666666666667,63.333333333333336,-97.5,80C-87.08333333333333,96.66666666666667,-64.16666666666667,113.33333333333333,-52.708333333333336,121.66666666666667L-41.25,130"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-90.25430297851562" y="89.57839965820312" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node6->Node7">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-50,-19.047619047619072L-23.333333333333332,-29.206349206349227C3.3333333333333335,-39.36507936507938,56.666666666666664,-59.68253968253969,73.22289339701335,-77.19431625850618C89.77912012736003,-94.70609283447266,69.55824025472005,-109.41218566894531,59.44780031840006,-116.76523208618164L49.33736038208008,-124.11827850341797">
                                    </path>
                                    <path
                                        d="M-50,-19.047619047619072L-23.333333333333332,-29.206349206349227C3.3333333333333335,-39.36507936507938,56.666666666666664,-59.68253968253969,71.875,-78.17460317460318C87.08333333333333,-96.66666666666667,64.16666666666666,-113.33333333333333,52.70833333333332,-121.66666666666667L41.249999999999986,-130"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="44.54045867919922" y="-58.52943801879883" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node7->Node0">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M3.75,-190L4.791666666666667,-198.33333333333334C5.833333333333333,-206.66666666666666,7.916666666666667,-223.33333333333334,8.123311201731363,-238.34619140625C8.32995573679606,-253.35904947916666,6.659911473592122,-266.7180989583333,5.824889341990153,-273.3976236979167L4.989867210388184,-280.0771484375">
                                    </path>
                                    <path
                                        d="M3.75,-190L4.791666666666667,-198.33333333333334C5.833333333333333,-206.66666666666666,7.916666666666667,-223.33333333333334,7.916666666666668,-240C7.916666666666669,-256.6666666666667,5.833333333333338,-273.3333333333333,4.791666666666672,-281.6666666666667L3.750000000000007,-290"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="7.916666507720947" y="-240" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                                <g id="Node<:children:Node7->Node4">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M33.75,-130L43.125,-121.66666666666667C52.5,-113.33333333333333,71.25,-96.66666666666667,92.29407755533855,-88.96166865030925C113.33815511067708,-81.25667063395183,136.67631022135416,-82.51334126790364,148.34538777669272,-83.14167658487956L160.01446533203125,-83.77001190185547">
                                    </path>
                                    <path
                                        d="M33.75,-130L43.125,-121.66666666666667C52.5,-113.33333333333333,71.25,-96.66666666666667,93.95833333333333,-89.05128205128204C116.66666666666667,-81.43589743589743,143.33333333333334,-82.87179487179486,156.66666666666666,-83.58974358974358L170,-84.30769230769229"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="95.5332260131836" y="-88.53950500488281" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">children</text>
                                </g>
                            </g>
                        </g>
                    </g>

                </g>
            </svg>
        </div>
    </div>
    <script>
        // Add zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 10]) // Set the zoom scale extent
            .on('zoom', zoomed);

        function zoomed(event) {
            d3.select('.zoomable').attr('transform', event.transform);
        }
        const diagram = d3.select('#diagram');
        diagram.call(zoom);


        // Select all nodes and make them draggable
        const nodes = d3.selectAll('.nodes g');

        function getNodePositions() {
            const positions = {};
            nodes.each(function () {
                const node = d3.select(this);
                const transform = node.attr('transform');
                const translate = transform.match(/translate\(([^, ]+)[, ]+([^)]+)\)/);
                if (translate) {
                    const x = parseFloat(translate[1]);
                    const y = parseFloat(translate[2]);
                    positions[node.attr('id')] = { x, y };
                }
            });
            console.log(positions);
            return positions;
        }

        // Store the initial positions of the nodes
        const nodePositions = getNodePositions();

        function getEdgeSourceAndTarget(edgeId) {
            // First find the id of the last : character and get the substring after it
            const byParts = edgeId.split(':');
            let rel = byParts[byParts.length - 1];

            const [sourceId, targetId] = rel.split('->');
            return { sourceId, targetId };
        }

        function updatePath(path, startX, startY, endX, endY) {
            const controlPoint1 = `${(startX + endX) / 2},${startY}`;
            const controlPoint2 = `${(startX + endX) / 2},${endY}`;
            const newD = `M${startX},${startY} C${controlPoint1},${controlPoint2},${endX},${endY}`;
            path.attr('d', newD);
        }

        function getIntersectionPoint(node, targetNode) {
            const dx = targetNode.x - node.x;
            const dy = targetNode.y - node.y;
            const absDx = Math.abs(dx);
            const absDy = Math.abs(dy);

            let x = node.x;
            let y = node.y;

            const halfWidth = 50;
            const halfHeight = 30;

            if (absDx > absDy) {
                x += dx > 0 ? halfWidth : -halfWidth;
                y += dy * (halfWidth / absDx);
            } else {
                x += dx * (halfHeight / absDy);
                y += dy > 0 ? halfHeight : -halfHeight;
            }

            return { x, y };
        }

        function updateEdges(nodeId) {
            const node = nodePositions[nodeId];
            // Update edges where the node is the source
            d3.selectAll(`g[id*=":${nodeId}->"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (sourceId === nodeId);

                const targetNode = nodePositions[targetId];
                const sourceIntersection = getIntersectionPoint(node, targetNode);
                const targetIntersection = getIntersectionPoint(targetNode, node);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });

            // Update edges where the node is the target
            d3.selectAll(`g[id*="->${nodeId}"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (targetId === nodeId);

                const sourceNode = nodePositions[sourceId];
                const sourceIntersection = getIntersectionPoint(sourceNode, node);
                const targetIntersection = getIntersectionPoint(node, sourceNode);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });
        }

        nodes
            .call(d3.drag()
                .on('start', dragStarted)
                .on('drag', dragged)
                .on('end', dragEnded));

        function dragStarted(event, d) {
            d3.select(this).raise().attr('stroke', 'black');
        }

        function dragged(event, d) {
            const nodeId = d3.select(this).attr('id');
            nodePositions[nodeId].x = event.x;
            nodePositions[nodeId].y = event.y;
            d3.select(this).attr('transform', `translate(${event.x}, ${event.y})`);
            updateEdges(nodeId); // Update the edges during the drag event
        }

        function dragEnded(event, d) {
            d3.select(this).attr('stroke', null);
        }



        /**** This bit ensures we zoom to fit ***/
        const bbox = d3.select('.zoomable').node().getBBox();
        const padding = 10; // Padding in pixels

        const viewBox = [
            bbox.x - padding,
            bbox.y - padding,
            bbox.width + 2 * padding,
            bbox.height + 2 * padding
        ].join(' ');


        const topSvg = d3.select("#diagram");
        topSvg.attr('viewBox', viewBox);
        /*************************************/

    </script>
</body>

</html>