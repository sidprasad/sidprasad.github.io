<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Zoomable Image</title>
    <style>
        #svg-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #zoomable-image {
            width: 100%;
            height: auto;
        }

        .svg-border {
            border: 2px solid black;
        }
    </style>
    <!-- Include D3.js library -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>

    <div class="container">


        <div class="container-fluid" id="svg-container">
            <svg id="diagram" width="800" height="800" class="svg-border">
                <g class="zoomable">


                        <g
                            transform="matrix(0.8072167433022015,0,0,0.8072167433022015,88.04981560947215,14.073177738939277)">
                            <g id="">
                                <defs>
                                    <marker id="arrow-10-[#333]" viewBox="0 0 10 10" refX="0" refY="5" markerWidth="10"
                                        markerHeight="10" markerUnits="userSpaceOnUse" orient="auto" fill="#333">
                                        <path d="M 0 0 L 10 5 L 0 10 z"></path>
                                    </marker>
                                </defs>
                                <g class="nodes">
                                    <g id="Card0" transform="translate(65 400)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Card0</text>
                                    </g>
                                    <g id="Card1" transform="translate(-265 -80)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Card1</text>
                                    </g>
                                    <g id="Card2" transform="translate(-15 240)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Card2</text>
                                    </g>
                                    <g id="Card3" transform="translate(-110 80)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Card3</text>
                                    </g>
                                    <g id="Card4" transform="translate(-265 -240)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Card4</text>
                                    </g>
                                    <g id="Player0" transform="translate(55 -400)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player0</text>
                                    </g>
                                    <g id="Player1" transform="translate(26.673024146249986 -185.3000953031251)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player1</text>
                                    </g>
                                    <g id="Player2" transform="translate(90 80)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player2</text>
                                    </g>
                                    <g id="Player3" transform="translate(-65 -240)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player3</text>
                                    </g>
                                    <g id="Player4" transform="translate(185 240)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player4</text>
                                    </g>
                                    <g id="Dealer0" transform="translate(265 400)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Dealer0</text>
                                    </g>
                                </g>
                                <g class="edges">
                                    <g id="Player<:left:Player0->Player3">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M5,-374.19354838709677L-12.5,-365.16129032258067C-30,-356.12903225806457,-65,-338.06451612903226,-79.52209599812825,-322.2258971839823C-94.04419199625652,-306.3872782389323,-88.08838399251302,-292.77455647786456,-85.11047999064128,-285.96819559733075L-82.13257598876953,-279.1618347167969">
                                        </path>
                                        <path
                                            d="M5,-374.19354838709677L-12.5,-365.16129032258067C-30,-356.12903225806457,-65,-338.06451612903226,-78.85416666666667,-320.6989247311828C-92.70833333333333,-303.3333333333333,-85.41666666666667,-286.6666666666667,-81.77083333333334,-278.3333333333333L-78.12500000000001,-270"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-61.950443267822266" y="-336.08416748046875" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player1->Player2">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M28.0211576979562,-155.3000953031251L29.184298081630164,-129.41674608593758C30.347438465304133,-103.53339686875006,32.67371923265207,-51.76669843437503,38.621811144239445,-18.92341879726564C44.56990305582682,13.91986083984375,54.13980611165365,27.8397216796875,58.924757639567055,34.799652099609375L63.70970916748047,41.75958251953125">
                                        </path>
                                        <path
                                            d="M28.0211576979562,-155.3000953031251L29.184298081630164,-129.41674608593758C30.347438465304133,-103.53339686875006,32.67371923265207,-51.76669843437503,39.5660262829927,-17.550015883854183C46.458333333333336,16.666666666666668,57.916666666666664,33.333333333333336,63.645833333333336,41.666666666666664L69.375,50"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="34.81752014160156" y="-49.099910736083984" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player2->Player4">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M90,110L90,118.33333333333333C90,126.66666666666667,90,143.33333333333334,98.62098185221355,158.9264399210612C107.24196370442708,174.51954650878906,124.48392740885417,189.03909301757812,133.10490926106772,196.29886627197266L141.72589111328125,203.5586395263672">
                                        </path>
                                        <path
                                            d="M90,110L90,118.33333333333333C90,126.66666666666667,90,143.33333333333334,99.89583333333333,160C109.79166666666667,176.66666666666666,129.58333333333331,193.33333333333334,139.47916666666666,201.66666666666666L149.37499999999997,210"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="105.21586608886719" y="167.82272338867188" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player3->Player1">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M-98.75,-210L-108.125,-201.66666666666666C-117.5,-193.33333333333334,-136.25,-176.66666666666666,-125.33023262023926,-171.15961710611978C-114.41046524047852,-165.6525675455729,-73.82093048095703,-171.30513509114584,-53.52616310119629,-174.13141886393228L-33.23139572143555,-176.95770263671875">
                                        </path>
                                        <path
                                            d="M-98.75,-210L-108.125,-201.66666666666666C-117.5,-193.33333333333334,-136.25,-176.66666666666666,-123.679495975625,-171.38950166597934C-111.10899195125,-166.11233666529202,-67.21798390250001,-172.224673330584,-45.27247987812501,-175.28084166323004L-23.326975853750014,-178.33700999587603"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-99.4629135131836" y="-169.48211669921875" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player4->Player0">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M198.125,210L201.77083333333334,201.66666666666666C205.41666666666666,193.33333333333334,212.70833333333334,176.66666666666666,216.35416666666666,155C220,133.33333333333334,220,106.66666666666667,220,80C220,53.333333333333336,220,26.666666666666668,220,0C220,-26.666666666666668,220,-53.333333333333336,220,-80C220,-106.66666666666667,220,-133.33333333333334,220,-160C220,-186.66666666666666,220,-213.33333333333334,220,-240C220,-266.6666666666667,220,-293.3333333333333,202.33302434285483,-315.2324727376302C184.66604868570963,-337.13161214192706,149.33209737141928,-354.2632242838542,131.66512171427408,-362.8290303548177L113.9981460571289,-371.39483642578125">
                                        </path>
                                        <path
                                            d="M198.125,210L201.77083333333334,201.66666666666666C205.41666666666666,193.33333333333334,212.70833333333334,176.66666666666666,216.35416666666666,155C220,133.33333333333334,220,106.66666666666667,220,80C220,53.333333333333336,220,26.666666666666668,220,0C220,-26.666666666666668,220,-53.333333333333336,220,-80C220,-106.66666666666667,220,-133.33333333333334,220,-160C220,-186.66666666666666,220,-213.33333333333334,220,-240C220,-266.6666666666667,220,-293.3333333333333,200.83333333333334,-315.95959595959596C181.66666666666666,-338.5858585858586,143.33333333333334,-357.17171717171715,124.16666666666667,-366.4646464646465L105,-375.75757575757575"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="220"
                                            y="-110.32656860351562" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:right:Player0->Player4">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M105,-372.4137931034483L120.83333333333333,-363.6781609195403C136.66666666666666,-354.94252873563227,168.33333333333334,-337.4712643678161,184.16666666666666,-315.4022988505747C200,-293.3333333333333,200,-266.6666666666667,200,-240C200,-213.33333333333334,200,-186.66666666666666,200,-160C200,-133.33333333333334,200,-106.66666666666667,200,-80C200,-53.333333333333336,200,-26.666666666666668,200,0C200,26.666666666666668,200,53.333333333333336,200,80C200,106.66666666666667,200,133.33333333333334,198.74455769856772,153.36186726888022C197.4891153971354,173.3904012044271,194.97823079427084,186.78080240885416,193.72278849283853,193.47600301106772L192.46734619140625,200.17120361328125">
                                        </path>
                                        <path
                                            d="M105,-372.4137931034483L120.83333333333333,-363.6781609195403C136.66666666666666,-354.94252873563227,168.33333333333334,-337.4712643678161,184.16666666666666,-315.4022988505747C200,-293.3333333333333,200,-266.6666666666667,200,-240C200,-213.33333333333334,200,-186.66666666666666,200,-160C200,-133.33333333333334,200,-106.66666666666667,200,-80C200,-53.333333333333336,200,-26.666666666666668,200,0C200,26.666666666666668,200,53.333333333333336,200,80C200,106.66666666666667,200,133.33333333333334,198.4375,155C196.875,176.66666666666666,193.75,193.33333333333334,192.1875,201.66666666666666L190.625,210"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="200"
                                            y="-103.07574462890625" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player1->Player3">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M76.67302414624999,-156.10339416648745L75.56085345520832,-156.75282847207288C74.44868276416666,-157.4022627776583,72.22434138208332,-158.70113138882914,58.37932315940511,-166.895958048744C44.53430493672689,-175.09078470865884,19.068609873453777,-190.18156941731772,6.33576234181722,-197.72696177164713L-6.397085189819336,-205.27235412597656">
                                        </path>
                                        <path
                                            d="M76.67302414624999,-156.10339416648745L75.56085345520832,-156.75282847207288C74.44868276416666,-157.4022627776583,72.22434138208332,-158.70113138882914,56.945504024375,-167.74562742280963C41.666666666666664,-176.79012345679016,13.333333333333334,-193.58024691358025,-0.8333333333333334,-201.97530864197532L-15,-210.37037037037038"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="30.826183319091797" y="-183.21939086914062" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player2->Player3">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M106.875,50L111.5625,41.666666666666664C116.25,33.333333333333336,125.625,16.666666666666668,130.3125,-5C135,-26.666666666666668,135,-53.333333333333336,135,-80C135,-106.66666666666667,135,-133.33333333333334,111.54746119181316,-156.0476811726888C88.0949223836263,-178.76202901204428,41.1898447672526,-197.52405802408853,17.737305959065754,-206.9050725301107L-5.715232849121094,-216.2860870361328">
                                        </path>
                                        <path
                                            d="M106.875,50L111.5625,41.666666666666664C116.25,33.333333333333336,125.625,16.666666666666668,130.3125,-5C135,-26.666666666666668,135,-53.333333333333336,135,-80C135,-106.66666666666667,135,-133.33333333333334,110,-156.66666666666666C85,-180,35,-200,10,-210L-15,-220"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="130.6431884765625" y="-124.10452270507812" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player3->Player0">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M-15,-260L10,-270C35,-280,85,-300,102.8451779683431,-317.1548207600911C120.6903559366862,-334.3096415201823,106.38071187337239,-348.61928304036456,99.2258898417155,-355.77410380045575L92.0710678100586,-362.9289245605469">
                                        </path>
                                        <path
                                            d="M-15,-260L10,-270C35,-280,85,-300,101.66666666666667,-318.3333333333333C118.33333333333333,-336.6666666666667,101.66666666666667,-353.3333333333333,93.33333333333333,-361.6666666666667L85,-370"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="73.5163345336914" y="-298.4776611328125" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player4->Player2">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M205.625,210L211.35416666666666,201.66666666666666C217.08333333333334,193.33333333333334,228.54166666666666,176.66666666666666,219.0747553507487,160.22875849405924C209.60784403483072,143.7908503214518,179.21568806966147,127.58170064290364,164.0196100870768,119.47712580362956L148.8235321044922,111.37255096435547">
                                        </path>
                                        <path
                                            d="M205.625,210L211.35416666666666,201.66666666666666C217.08333333333334,193.33333333333334,228.54166666666666,176.66666666666666,217.60416666666666,159.44444444444443C206.66666666666666,142.2222222222222,173.33333333333334,124.44444444444441,156.66666666666666,115.55555555555553L140,106.66666666666664"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="204.35169982910156" y="145.3394317626953" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:hand:Player0->Card4">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M5,-387.5L-40,-376.25C-85,-365,-175,-342.5,-219.9981435139974,-324.5833231608073C-264.9962870279948,-306.66664632161456,-264.99257405598956,-293.3332926432292,-264.990717569987,-286.66661580403644L-264.9888610839844,-279.99993896484375">
                                        </path>
                                        <path
                                            d="M5,-387.5L-40,-376.25C-85,-365,-175,-342.5,-220,-322.9166666666667C-265,-303.3333333333333,-265,-286.6666666666667,-265,-278.3333333333333L-265,-270"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-144.9322509765625" y="-348.4408874511719" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">hand</text>
                                    </g>
                                    <g id="Player<:hand:Player1->Card3">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M4.54572454783283,-155.3000953031251L-14.545229543472642,-129.41674608593758C-33.636183634778114,-103.53339686875006,-71.81809181738906,-51.76669843437503,-90.90826262418932,-19.216681914737972C-109.99843343098958,13.333334604899088,-109.99686686197917,26.666669209798176,-109.99608357747395,33.33333651224772L-109.99530029296875,40.000003814697266">
                                        </path>
                                        <path
                                            d="M4.54572454783283,-155.3000953031251L-14.545229543472642,-129.41674608593758C-33.636183634778114,-103.53339686875006,-71.81809181738906,-51.76669843437503,-90.90904590869452,-17.550015883854183C-110,16.666666666666668,-110,33.333333333333336,-110,41.666666666666664L-110,50"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-65.28282165527344" y="-58.36397933959961" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">hand</text>
                                    </g>
                                    <g id="Player<:hand:Player2->Card2">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M50.625000000000014,110L39.68750000000001,118.33333333333333C28.75000000000001,126.66666666666667,6.875000000000004,143.33333333333334,-4.062046845753986,158.33333333333334C-14.999093691507975,173.33333333333334,-14.998187383015951,186.66666666666666,-14.997734228769938,193.33333333333334L-14.997281074523926,200">
                                        </path>
                                        <path
                                            d="M50.625000000000014,110L39.68750000000001,118.33333333333333C28.75000000000001,126.66666666666667,6.875000000000004,143.33333333333334,-4.0625,160C-15.000000000000005,176.66666666666666,-15.000000000000009,193.33333333333334,-15.000000000000012,201.66666666666666L-15.000000000000014,210"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="2.710874080657959" y="151.12796020507812" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">hand</text>
                                    </g>
                                    <g id="Player<:hand:Player3->Card1">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M-115,-220L-140,-210C-165,-200,-215,-180,-239.99896748860678,-163.3333307902018C-264.99793497721356,-146.66666158040366,-264.99586995442706,-133.33332316080728,-264.9948374430339,-126.66665395100911L-264.9938049316406,-119.99998474121094">
                                        </path>
                                        <path
                                            d="M-115,-220L-140,-210C-165,-200,-215,-180,-240,-161.66666666666666C-265,-143.33333333333334,-265,-126.66666666666667,-265,-118.33333333333333L-265,-110"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-206.47821044921875" y="-181.14208984375" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">hand</text>
                                    </g>
                                    <g id="Player<:hand:Player4->Card0">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M139.99999999999997,270L127.49999999999999,278.3333333333333C114.99999999999999,286.6666666666667,90,303.3333333333333,77.50051752726237,318.3333384195964C65.00103505452473,333.3333435058594,65.00207010904948,346.66668701171875,65.00258763631184,353.33335876464844L65.00310516357422,360.0000305175781">
                                        </path>
                                        <path
                                            d="M139.99999999999997,270L127.49999999999999,278.3333333333333C114.99999999999999,286.6666666666667,90,303.3333333333333,77.5,320C65,336.6666666666667,65,353.3333333333333,65,361.6666666666667L65,370"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="86.70252990722656" y="309.6703796386719" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">hand</text>
                                    </g>
                                    <g id="Player<:holding:Player4->Dealer0">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M215,270L223.33333333333334,278.3333333333333C231.66666666666666,286.6666666666667,248.33333333333334,303.3333333333333,256.66631571451825,318.3333333333333C264.9992980957031,333.3333333333333,264.99859619140625,346.6666666666667,264.9982452392578,353.3333333333333L264.9978942871094,360">
                                        </path>
                                        <path
                                            d="M215,270L223.33333333333334,278.3333333333333C231.66666666666666,286.6666666666667,248.33333333333334,303.3333333333333,256.6666666666667,320C265,336.6666666666667,265,353.3333333333333,265,361.6666666666667L265,370"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="253.22592163085938" y="313.8355712890625" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">holding</text>
                                    </g>
                                </g>
                            </g>
                        </g>

                </g>
            </svg>
        </div>
    </div>
    <script>
        // Add zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 10]) // Set the zoom scale extent
            .on('zoom', zoomed);

        function zoomed(event) {
            d3.select('.zoomable').attr('transform', event.transform);
        }
        const diagram = d3.select('#diagram');
        diagram.call(zoom);


        // Select all nodes and make them draggable
        const nodes = d3.selectAll('.nodes g');

        function getNodePositions() {
            const positions = {};
            nodes.each(function () {
                const node = d3.select(this);
                const transform = node.attr('transform');
                const translate = transform.match(/translate\(([^, ]+)[, ]+([^)]+)\)/);
                if (translate) {
                    const x = parseFloat(translate[1]);
                    const y = parseFloat(translate[2]);
                    positions[node.attr('id')] = { x, y };
                }
            });
            console.log(positions);
            return positions;
        }

        // Store the initial positions of the nodes
        const nodePositions = getNodePositions();

        function getEdgeSourceAndTarget(edgeId) {
            // First find the id of the last : character and get the substring after it
            const byParts = edgeId.split(':');
            let rel = byParts[byParts.length - 1];

            const [sourceId, targetId] = rel.split('->');
            return { sourceId, targetId };
        }

        function updatePath(path, startX, startY, endX, endY) {
            const controlPoint1 = `${(startX + endX) / 2},${startY}`;
            const controlPoint2 = `${(startX + endX) / 2},${endY}`;
            const newD = `M${startX},${startY} C${controlPoint1},${controlPoint2},${endX},${endY}`;
            path.attr('d', newD);
        }

        function getIntersectionPoint(node, targetNode) {
            const dx = targetNode.x - node.x;
            const dy = targetNode.y - node.y;
            const absDx = Math.abs(dx);
            const absDy = Math.abs(dy);

            let x = node.x;
            let y = node.y;

            const halfWidth = 50;
            const halfHeight = 30;

            if (absDx > absDy) {
                x += dx > 0 ? halfWidth : -halfWidth;
                y += dy * (halfWidth / absDx);
            } else {
                x += dx * (halfHeight / absDy);
                y += dy > 0 ? halfHeight : -halfHeight;
            }

            return { x, y };
        }

        function updateEdges(nodeId) {
            const node = nodePositions[nodeId];
            // Update edges where the node is the source
            d3.selectAll(`g[id*=":${nodeId}->"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (sourceId === nodeId);

                const targetNode = nodePositions[targetId];
                const sourceIntersection = getIntersectionPoint(node, targetNode);
                const targetIntersection = getIntersectionPoint(targetNode, node);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });

            // Update edges where the node is the target
            d3.selectAll(`g[id*="->${nodeId}"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (targetId === nodeId);

                const sourceNode = nodePositions[sourceId];
                const sourceIntersection = getIntersectionPoint(sourceNode, node);
                const targetIntersection = getIntersectionPoint(node, sourceNode);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });
        }

        nodes
            .call(d3.drag()
                .on('start', dragStarted)
                .on('drag', dragged)
                .on('end', dragEnded));

        function dragStarted(event, d) {
            d3.select(this).raise().attr('stroke', 'black');
        }

        function dragged(event, d) {
            const nodeId = d3.select(this).attr('id');
            nodePositions[nodeId].x = event.x;
            nodePositions[nodeId].y = event.y;
            d3.select(this).attr('transform', `translate(${event.x}, ${event.y})`);
            updateEdges(nodeId); // Update the edges during the drag event
        }

        function dragEnded(event, d) {
            d3.select(this).attr('stroke', null);
        }



        /**** This bit ensures we zoom to fit ***/
        const bbox = d3.select('.zoomable').node().getBBox();
        const padding = 10; // Padding in pixels

        const viewBox = [
            bbox.x - padding,
            bbox.y - padding,
            bbox.width + 2 * padding,
            bbox.height + 2 * padding
        ].join(' ');


        const topSvg = d3.select("#diagram");
        topSvg.attr('viewBox', viewBox);
        /*************************************/

    </script>
</body>

</html>