<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Zoomable Image</title>
    <style>
        #svg-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #zoomable-image {
            width: 100%;
            height: auto;
        }

        .svg-border {
            border: 2px solid black;
        }
    </style>
    <!-- Include D3.js library -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>

    <div class="container">


        <div class="container-fluid" id="svg-container">
            <svg id="diagram" width="800" height="800" class="svg-border">
                <g class="zoomable">
                    <g
                        transform="matrix(0.7651343538409493,0,0,0.7651343538409493,140.52087485375813,-0.3234184240616269)">
                        <g id="">
                            <defs>
                                <marker id="arrow-10-[#333]" viewBox="0 0 10 10" refX="0" refY="5" markerWidth="10"
                                    markerHeight="10" markerUnits="userSpaceOnUse" orient="auto" fill="#333">
                                    <path d="M 0 0 L 10 5 L 0 10 z"></path>
                                </marker>
                            </defs>
                            <g class="nodes">
                                <g id="Mouth" transform="translate(-115 480)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(0, 80, 240); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Mouth</text>
                                </g>
                                <g id="Nose" transform="translate(-60 320)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(36, 168, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Nose</text>
                                </g>
                                <g id="Chin" transform="translate(-170 640)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(158, 108, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Chin</text>
                                </g>
                                <g id="Face" transform="translate(-130 -640)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Face</text>
                                </g>
                                <g id="EyeBrowA" transform="translate(60 -320)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(87, 12, 228); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">EyeBrowA</text>
                                </g>
                                <g id="EyeBrowB" transform="translate(5 160)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(87, 12, 228); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">EyeBrowB</text>
                                </g>
                                <g id="Eye2" transform="translate(-50 0)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(228, 7, 7); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Eye2</text>
                                </g>
                                <g id="Eye1" transform="translate(5 -160)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(228, 7, 7); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Eye1</text>
                                </g>
                                <g id="Hair" transform="translate(170 -480)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(179, 140, 0); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Hair</text>
                                </g>
                            </g>
                            <g class="edges">
                                <g id="Face<:parts:Face->EyeBrowA">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-80,-612.4137931034483L-64.16666666666667,-603.6781609195402C-48.333333333333336,-594.9425287356322,-16.666666666666668,-577.4712643678162,-0.8333333333333334,-555.4022988505748C15,-533.3333333333334,15,-506.6666666666667,15,-480C15,-453.3333333333333,15,-426.6666666666667,18.870452880859375,-406.45265706380206C22.74090576171875,-386.2386474609375,30.4818115234375,-372.477294921875,34.352264404296875,-365.59661865234375L38.22271728515625,-358.7159423828125">
                                    </path>
                                    <path
                                        d="M-80,-612.4137931034483L-64.16666666666667,-603.6781609195402C-48.333333333333336,-594.9425287356322,-16.666666666666668,-577.4712643678162,-0.8333333333333334,-555.4022988505748C15,-533.3333333333334,15,-506.6666666666667,15,-480C15,-453.3333333333333,15,-426.6666666666667,19.687499999999996,-405C24.374999999999996,-383.3333333333333,33.74999999999999,-366.6666666666667,38.43749999999999,-358.3333333333333L43.124999999999986,-350"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="14.72130012512207" y="-500.7120666503906" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parts</text>
                                </g>
                                <g id="Face<:parts:Face->Eye2">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-124.375,-610L-122.8125,-601.6666666666666C-121.25,-593.3333333333334,-118.125,-576.6666666666666,-116.5625,-555C-115,-533.3333333333334,-115,-506.6666666666667,-115,-480C-115,-453.3333333333333,-115,-426.6666666666667,-115,-400C-115,-373.3333333333333,-115,-346.6666666666667,-115,-320C-115,-293.3333333333333,-115,-266.6666666666667,-115,-240C-115,-213.33333333333334,-115,-186.66666666666666,-115,-160C-115,-133.33333333333334,-115,-106.66666666666667,-109.28015518188477,-86.29352315266927C-103.56031036376953,-65.92037963867188,-92.12062072753906,-51.84075927734375,-86.40077590942383,-44.80094909667969L-80.6809310913086,-37.761138916015625">
                                    </path>
                                    <path
                                        d="M-124.375,-610L-122.8125,-601.6666666666666C-121.25,-593.3333333333334,-118.125,-576.6666666666666,-116.5625,-555C-115,-533.3333333333334,-115,-506.6666666666667,-115,-480C-115,-453.3333333333333,-115,-426.6666666666667,-115,-400C-115,-373.3333333333333,-115,-346.6666666666667,-115,-320C-115,-293.3333333333333,-115,-266.6666666666667,-115,-240C-115,-213.33333333333334,-115,-186.66666666666666,-115,-160C-115,-133.33333333333334,-115,-106.66666666666667,-108.22916666666667,-85C-101.45833333333333,-63.333333333333336,-87.91666666666667,-46.666666666666664,-81.14583333333333,-38.333333333333336L-74.375,-30"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="-115"
                                        y="-314.9960632324219" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parts</text>
                                </g>
                                <g id="Face<:parts:Face->Nose">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-163.75,-610L-173.125,-601.6666666666666C-182.5,-593.3333333333334,-201.25,-576.6666666666666,-210.625,-555C-220,-533.3333333333334,-220,-506.6666666666667,-220,-480C-220,-453.3333333333333,-220,-426.6666666666667,-220,-400C-220,-373.3333333333333,-220,-346.6666666666667,-220,-320C-220,-293.3333333333333,-220,-266.6666666666667,-220,-240C-220,-213.33333333333334,-220,-186.66666666666666,-220,-160C-220,-133.33333333333334,-220,-106.66666666666667,-220,-80C-220,-53.333333333333336,-220,-26.666666666666668,-220,0C-220,26.666666666666668,-220,53.333333333333336,-220,80C-220,106.66666666666667,-220,133.33333333333334,-220,160C-220,186.66666666666666,-220,213.33333333333334,-203.15737915039062,235.08797709147134C-186.31475830078125,256.8426208496094,-152.6295166015625,273.68524169921875,-135.78689575195312,282.10655212402344L-118.94427490234375,290.5278625488281">
                                    </path>
                                    <path
                                        d="M-163.75,-610L-173.125,-601.6666666666666C-182.5,-593.3333333333334,-201.25,-576.6666666666666,-210.625,-555C-220,-533.3333333333334,-220,-506.6666666666667,-220,-480C-220,-453.3333333333333,-220,-426.6666666666667,-220,-400C-220,-373.3333333333333,-220,-346.6666666666667,-220,-320C-220,-293.3333333333333,-220,-266.6666666666667,-220,-240C-220,-213.33333333333334,-220,-186.66666666666666,-220,-160C-220,-133.33333333333334,-220,-106.66666666666667,-220,-80C-220,-53.333333333333336,-220,-26.666666666666668,-220,0C-220,26.666666666666668,-220,53.333333333333336,-220,80C-220,106.66666666666667,-220,133.33333333333334,-220,160C-220,186.66666666666666,-220,213.33333333333334,-201.66666666666666,235.83333333333334C-183.33333333333334,258.3333333333333,-146.66666666666666,276.6666666666667,-128.33333333333334,285.8333333333333L-110,295"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="-220"
                                        y="-139.68685913085938" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parts</text>
                                </g>
                                <g id="Face<:parts:Face->Mouth">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-180,-612.4137931034483L-195.83333333333334,-603.6781609195402C-211.66666666666666,-594.9425287356322,-243.33333333333334,-577.4712643678162,-259.1666666666667,-555.4022988505748C-275,-533.3333333333334,-275,-506.6666666666667,-275,-480C-275,-453.3333333333333,-275,-426.6666666666667,-275,-400C-275,-373.3333333333333,-275,-346.6666666666667,-275,-320C-275,-293.3333333333333,-275,-266.6666666666667,-275,-240C-275,-213.33333333333334,-275,-186.66666666666666,-275,-160C-275,-133.33333333333334,-275,-106.66666666666667,-275,-80C-275,-53.333333333333336,-275,-26.666666666666668,-275,0C-275,26.666666666666668,-275,53.333333333333336,-275,80C-275,106.66666666666667,-275,133.33333333333334,-275,160C-275,186.66666666666666,-275,213.33333333333334,-275,240C-275,266.6666666666667,-275,293.3333333333333,-275,320C-275,346.6666666666667,-275,373.3333333333333,-258.1573791503906,395.0879770914714C-241.31475830078125,416.8426208496094,-207.6295166015625,433.68524169921875,-190.78689575195312,442.10655212402344L-173.94427490234375,450.5278625488281">
                                    </path>
                                    <path
                                        d="M-180,-612.4137931034483L-195.83333333333334,-603.6781609195402C-211.66666666666666,-594.9425287356322,-243.33333333333334,-577.4712643678162,-259.1666666666667,-555.4022988505748C-275,-533.3333333333334,-275,-506.6666666666667,-275,-480C-275,-453.3333333333333,-275,-426.6666666666667,-275,-400C-275,-373.3333333333333,-275,-346.6666666666667,-275,-320C-275,-293.3333333333333,-275,-266.6666666666667,-275,-240C-275,-213.33333333333334,-275,-186.66666666666666,-275,-160C-275,-133.33333333333334,-275,-106.66666666666667,-275,-80C-275,-53.333333333333336,-275,-26.666666666666668,-275,0C-275,26.666666666666668,-275,53.333333333333336,-275,80C-275,106.66666666666667,-275,133.33333333333334,-275,160C-275,186.66666666666666,-275,213.33333333333334,-275,240C-275,266.6666666666667,-275,293.3333333333333,-275,320C-275,346.6666666666667,-275,373.3333333333333,-256.6666666666667,395.8333333333333C-238.33333333333334,418.3333333333333,-201.66666666666666,436.6666666666667,-183.33333333333334,445.8333333333333L-165,455"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="-275"
                                        y="-73.56353759765625" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parts</text>
                                </g>
                                <g id="Face<:parts:Face->Hair">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-80,-626.6666666666666L-38.333333333333336,-615.5555555555555C3.3333333333333335,-604.4444444444445,86.66666666666667,-582.2222222222222,128.33161163330078,-564.4444342719183C169.9965565999349,-546.6666463216146,169.99311319986978,-533.3332926432291,169.99139149983725,-526.6666158040365L169.9896697998047,-519.9999389648438">
                                    </path>
                                    <path
                                        d="M-80,-626.6666666666666L-38.333333333333336,-615.5555555555555C3.3333333333333335,-604.4444444444445,86.66666666666667,-582.2222222222222,128.33333333333334,-562.7777777777777C170,-543.3333333333334,170,-526.6666666666666,170,-518.3333333333334L170,-510"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="60.20036697387695" y="-587.642333984375" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parts</text>
                                </g>
                                <g id="Face<:parts:Face->EyeBrowB">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-148.75,-610L-153.95833333333334,-601.6666666666666C-159.16666666666666,-593.3333333333334,-169.58333333333334,-576.6666666666666,-174.79166666666666,-555C-180,-533.3333333333334,-180,-506.6666666666667,-180,-480C-180,-453.3333333333333,-180,-426.6666666666667,-180,-400C-180,-373.3333333333333,-180,-346.6666666666667,-180,-320C-180,-293.3333333333333,-180,-266.6666666666667,-180,-240C-180,-213.33333333333334,-180,-186.66666666666666,-180,-160C-180,-133.33333333333334,-180,-106.66666666666667,-180,-80C-180,-53.333333333333336,-180,-26.666666666666668,-180,0C-180,26.666666666666668,-180,53.333333333333336,-159.0297622680664,75.73487854003906C-138.0595245361328,98.1364237467448,-96.11904907226562,116.27284749348958,-75.14881134033203,125.34105936686198L-54.17857360839844,134.40927124023438">
                                    </path>
                                    <path
                                        d="M-148.75,-610L-153.95833333333334,-601.6666666666666C-159.16666666666666,-593.3333333333334,-169.58333333333334,-576.6666666666666,-174.79166666666666,-555C-180,-533.3333333333334,-180,-506.6666666666667,-180,-480C-180,-453.3333333333333,-180,-426.6666666666667,-180,-400C-180,-373.3333333333333,-180,-346.6666666666667,-180,-320C-180,-293.3333333333333,-180,-266.6666666666667,-180,-240C-180,-213.33333333333334,-180,-186.66666666666666,-180,-160C-180,-133.33333333333334,-180,-106.66666666666667,-180,-80C-180,-53.333333333333336,-180,-26.666666666666668,-180,0C-180,26.666666666666668,-180,53.333333333333336,-157.5,76.3963963963964C-135,99.45945945945947,-90,118.91891891891892,-67.5,128.64864864864865L-45,138.3783783783784"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="-180"
                                        y="-202.63912963867188" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parts</text>
                                </g>
                                <g id="Face<:parts:Face->Chin">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-180,-620.952380952381L-206.66666666666666,-610.7936507936507C-233.33333333333334,-600.6349206349206,-286.6666666666667,-580.3174603174604,-313.3333333333333,-556.8253968253968C-340,-533.3333333333334,-340,-506.6666666666667,-340,-480C-340,-453.3333333333333,-340,-426.6666666666667,-340,-400C-340,-373.3333333333333,-340,-346.6666666666667,-340,-320C-340,-293.3333333333333,-340,-266.6666666666667,-340,-240C-340,-213.33333333333334,-340,-186.66666666666666,-340,-160C-340,-133.33333333333334,-340,-106.66666666666667,-340,-80C-340,-53.333333333333336,-340,-26.666666666666668,-340,0C-340,26.666666666666668,-340,53.333333333333336,-340,80C-340,106.66666666666667,-340,133.33333333333334,-340,160C-340,186.66666666666666,-340,213.33333333333334,-340,240C-340,266.6666666666667,-340,293.3333333333333,-340,320C-340,346.6666666666667,-340,373.3333333333333,-340,400C-340,426.6666666666667,-340,453.3333333333333,-340,480C-340,506.6666666666667,-340,533.3333333333334,-321.5080312093099,555.3687744140625C-303.0160624186198,577.4042154947916,-266.03212483723956,594.8084309895834,-247.54015604654947,603.5105387369791L-229.04818725585938,612.212646484375">
                                    </path>
                                    <path
                                        d="M-180,-620.952380952381L-206.66666666666666,-610.7936507936507C-233.33333333333334,-600.6349206349206,-286.6666666666667,-580.3174603174604,-313.3333333333333,-556.8253968253968C-340,-533.3333333333334,-340,-506.6666666666667,-340,-480C-340,-453.3333333333333,-340,-426.6666666666667,-340,-400C-340,-373.3333333333333,-340,-346.6666666666667,-340,-320C-340,-293.3333333333333,-340,-266.6666666666667,-340,-240C-340,-213.33333333333334,-340,-186.66666666666666,-340,-160C-340,-133.33333333333334,-340,-106.66666666666667,-340,-80C-340,-53.333333333333336,-340,-26.666666666666668,-340,0C-340,26.666666666666668,-340,53.333333333333336,-340,80C-340,106.66666666666667,-340,133.33333333333334,-340,160C-340,186.66666666666666,-340,213.33333333333334,-340,240C-340,266.6666666666667,-340,293.3333333333333,-340,320C-340,346.6666666666667,-340,373.3333333333333,-340,400C-340,426.6666666666667,-340,453.3333333333333,-340,480C-340,506.6666666666667,-340,533.3333333333334,-320,556.0784313725491C-300,578.8235294117648,-260,597.6470588235294,-240,607.0588235294118L-220,616.4705882352941"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="-340"
                                        y="-17.4237060546875" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parts</text>
                                </g>
                                <g id="Face<:parts:Face->Eye1">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-100,-610L-91.66666666666667,-601.6666666666666C-83.33333333333333,-593.3333333333334,-66.66666666666667,-576.6666666666666,-58.333333333333336,-555C-50,-533.3333333333334,-50,-506.6666666666667,-50,-480C-50,-453.3333333333333,-50,-426.6666666666667,-50,-400C-50,-373.3333333333333,-50,-346.6666666666667,-50,-320C-50,-293.3333333333333,-50,-266.6666666666667,-45.215048472086586,-246.37340291341147C-40.43009694417318,-226.08013916015625,-30.860193888346355,-212.1602783203125,-26.07524236043294,-205.20034790039062L-21.29029083251953,-198.24041748046875">
                                    </path>
                                    <path
                                        d="M-100,-610L-91.66666666666667,-601.6666666666666C-83.33333333333333,-593.3333333333334,-66.66666666666667,-576.6666666666666,-58.333333333333336,-555C-50,-533.3333333333334,-50,-506.6666666666667,-50,-480C-50,-453.3333333333333,-50,-426.6666666666667,-50,-400C-50,-373.3333333333333,-50,-346.6666666666667,-50,-320C-50,-293.3333333333333,-50,-266.6666666666667,-44.270833333333336,-245C-38.541666666666664,-223.33333333333334,-27.08333333333333,-206.66666666666666,-21.35416666666666,-198.33333333333334L-15.624999999999993,-190"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="-50"
                                        y="-403.8292541503906" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">parts</text>
                                </g>
                                <g id="FacePart<:below:EyeBrowA->Eye1">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M60,-290L60,-281.6666666666667C60,-273.3333333333333,60,-256.6666666666667,55.215048472086586,-241.37340291341147C50.43009694417318,-226.08013916015625,40.86019388834635,-212.1602783203125,36.075242360432945,-205.20034790039062L31.29029083251953,-198.24041748046875">
                                    </path>
                                    <path
                                        d="M60,-290L60,-281.6666666666667C60,-273.3333333333333,60,-256.6666666666667,54.270833333333336,-240C48.541666666666664,-223.33333333333334,37.08333333333334,-206.66666666666666,31.354166666666675,-198.33333333333334L25.625000000000014,-190"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="53.030128479003906" y="-236.61325073242188" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">below</text>
                                </g>
                                <g id="FacePart<:below:Eye2->Nose">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-100,26.66666666666669L-116.66666666666667,35.55555555555558C-133.33333333333334,44.44444444444446,-166.66666666666666,62.22222222222223,-183.33333333333334,84.44444444444444C-200,106.66666666666667,-200,133.33333333333334,-200,160C-200,186.66666666666666,-200,213.33333333333334,-186.44707234700522,234.41119384765625C-172.8941446940104,255.48905436197916,-145.78828938802084,270.9781087239583,-132.23536173502603,278.72263590494794L-118.68243408203125,286.4671630859375">
                                    </path>
                                    <path
                                        d="M-100,26.66666666666669L-116.66666666666667,35.55555555555558C-133.33333333333334,44.44444444444446,-166.66666666666666,62.22222222222223,-183.33333333333334,84.44444444444444C-200,106.66666666666667,-200,133.33333333333334,-200,160C-200,186.66666666666666,-200,213.33333333333334,-185,235.23809523809527C-170,257.14285714285717,-140,274.2857142857143,-125,282.8571428571429L-110,291.42857142857144"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-199.99693298339844" y="155.71302795410156" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">below</text>
                                </g>
                                <g id="FacePart<:below:Nose->Mouth">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-60,350L-60,358.3333333333333C-60,366.6666666666667,-60,383.3333333333333,-64.78495279947917,398.62659708658856C-69.56990559895833,413.91986083984375,-79.13981119791667,427.8397216796875,-83.92476399739583,434.7996520996094L-88.709716796875,441.75958251953125">
                                    </path>
                                    <path
                                        d="M-60,350L-60,358.3333333333333C-60,366.6666666666667,-60,383.3333333333333,-65.72916666666667,400C-71.45833333333333,416.6666666666667,-82.91666666666666,433.3333333333333,-88.64583333333331,441.6666666666667L-94.37499999999999,450"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-66.9698715209961" y="403.3867492675781" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">below</text>
                                </g>
                                <g id="FacePart<:below:Mouth->Chin">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-115,510L-115,518.3333333333334C-115,526.6666666666666,-115,543.3333333333334,-119.78495025634766,558.6265970865885C-124.56990051269531,573.9198608398438,-134.13980102539062,587.8397216796875,-138.92475128173828,594.7996520996094L-143.70970153808594,601.7595825195312">
                                    </path>
                                    <path
                                        d="M-115,510L-115,518.3333333333334C-115,526.6666666666666,-115,543.3333333333334,-120.72916666666667,560C-126.45833333333333,576.6666666666666,-137.91666666666666,593.3333333333334,-143.64583333333334,601.6666666666666L-149.375,610"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-121.96984100341797" y="563.3867797851562" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">below</text>
                                </g>
                                <g id="FacePart<:below:Hair->EyeBrowA">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M149.375,-450L143.64583333333334,-441.6666666666667C137.91666666666666,-433.3333333333333,126.45833333333333,-416.6666666666667,115.9442138671875,-401.37340291341144C105.43009440104167,-386.08013916015625,95.86018880208333,-372.1602783203125,91.07523600260417,-365.2003479003906L86.290283203125,-358.24041748046875">
                                    </path>
                                    <path
                                        d="M149.375,-450L143.64583333333334,-441.6666666666667C137.91666666666666,-433.3333333333333,126.45833333333333,-416.6666666666667,115,-400C103.54166666666667,-383.3333333333333,92.08333333333333,-366.6666666666667,86.35416666666669,-358.3333333333333L80.62500000000001,-350"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="115" y="-400"
                                        dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">below</text>
                                </g>
                                <g id="FacePart<:below:Hair->EyeBrowB">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M173.75,-450L174.79166666666666,-441.6666666666667C175.83333333333334,-433.3333333333333,177.91666666666666,-416.6666666666667,178.95833333333334,-395C180,-373.3333333333333,180,-346.6666666666667,180,-320C180,-293.3333333333333,180,-266.6666666666667,180,-240C180,-213.33333333333334,180,-186.66666666666666,180,-160C180,-133.33333333333334,180,-106.66666666666667,180,-80C180,-53.333333333333336,180,-26.666666666666668,180,0C180,26.666666666666668,180,53.333333333333336,160.68245697021484,75.49754333496094C141.3649139404297,97.66175333658855,102.72982788085938,115.32350667317708,83.41228485107422,124.15438334147136L64.09474182128906,132.98526000976562">
                                    </path>
                                    <path
                                        d="M173.75,-450L174.79166666666666,-441.6666666666667C175.83333333333334,-433.3333333333333,177.91666666666666,-416.6666666666667,178.95833333333334,-395C180,-373.3333333333333,180,-346.6666666666667,180,-320C180,-293.3333333333333,180,-266.6666666666667,180,-240C180,-213.33333333333334,180,-186.66666666666666,180,-160C180,-133.33333333333334,180,-106.66666666666667,180,-80C180,-53.333333333333336,180,-26.666666666666668,180,0C180,26.666666666666668,180,53.333333333333336,159.16666666666666,76.19047619047619C138.33333333333334,99.04761904761904,96.66666666666667,118.09523809523807,75.83333333333333,127.61904761904759L55,137.1428571428571"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="180"
                                        y="-123.85000610351562" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">below</text>
                                </g>
                                <g id="FacePart<:below:EyeBrowB->Nose">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M5,190L5,198.33333333333334C5,206.66666666666666,5,223.33333333333334,-0.7198464075724283,238.70647684733072C-6.4396928151448565,254.07962036132812,-17.879385630289715,268.15924072265625,-23.59923203786214,275.1990509033203L-29.31907844543457,282.2388610839844">
                                    </path>
                                    <path
                                        d="M5,190L5,198.33333333333334C5,206.66666666666666,5,223.33333333333334,-1.7708333333333357,240C-8.541666666666671,256.6666666666667,-22.083333333333343,273.3333333333333,-28.854166666666675,281.6666666666667L-35.625000000000014,290"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-3.744757652282715" y="244.4746856689453" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">below</text>
                                </g>
                                <g id="FacePart<:below:Eye1->Nose">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M55,-145.96491228070178L94.16666666666667,-134.97076023391816C133.33333333333334,-123.97660818713452,211.66666666666666,-101.98830409356727,250.83333333333334,-77.6608187134503C290,-53.333333333333336,290,-26.666666666666668,290,0C290,26.666666666666668,290,53.333333333333336,290,80C290,106.66666666666667,290,133.33333333333334,290,160C290,186.66666666666666,290,213.33333333333334,241.6247639656067,237.72386678059897C193.24952793121338,262.11440022786456,96.49905586242676,284.2288004557292,48.12381982803345,295.28600056966144L-0.2514162063598633,306.34320068359375">
                                    </path>
                                    <path
                                        d="M55,-145.96491228070178L94.16666666666667,-134.97076023391816C133.33333333333334,-123.97660818713452,211.66666666666666,-101.98830409356727,250.83333333333334,-77.6608187134503C290,-53.333333333333336,290,-26.666666666666668,290,0C290,26.666666666666668,290,53.333333333333336,290,80C290,106.66666666666667,290,133.33333333333334,290,160C290,186.66666666666666,290,213.33333333333334,240,238.09523809523807C190,262.85714285714283,90,285.7142857142857,40,297.1428571428571L-10,308.57142857142856"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="290"
                                        y="109.89520263671875" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">below</text>
                                </g>
                                <g id="FacePart<:aligned:Eye2->EyeBrowB">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M0,14.035087719298232L39.166666666666664,25.02923976608186C78.33333333333333,36.02339181286549,156.66666666666666,58.01169590643275,167.40749486287436,78.89309567457055C178.14832305908203,99.77449544270833,121.29664611816406,119.54899088541667,92.87080764770508,129.43623860677084L64.4449691772461,139.323486328125">
                                    </path>
                                    <path
                                        d="M0,14.035087719298232L39.166666666666664,25.02923976608186C78.33333333333333,36.02339181286549,156.66666666666666,58.01169590643275,165.83333333333334,79.44063056191203C175,100.8695652173913,115,121.73913043478261,85,132.17391304347825L55,142.6086956521739"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="149.05186462402344" y="64.2343521118164" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">aligned</text>
                                </g>
                                <g id="FacePart<:aligned:Eye1->Eye2">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M5,-130L5,-121.66666666666667C5,-113.33333333333333,5,-96.66666666666667,0.21504815419514975,-81.37340291341145C-4.5699036916097,-66.08013916015625,-14.1398073832194,-52.1602783203125,-18.92475922902425,-45.200347900390625L-23.7097110748291,-38.24041748046875">
                                    </path>
                                    <path
                                        d="M5,-130L5,-121.66666666666667C5,-113.33333333333333,5,-96.66666666666667,-0.7291666666666643,-80C-6.458333333333329,-63.333333333333336,-17.916666666666657,-46.666666666666664,-23.645833333333325,-38.333333333333336L-29.374999999999986,-30"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-1.9697365760803223" y="-76.61319732666016" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">aligned</text>
                                </g>
                            </g>
                        </g>
                    </g>


                </g>
            </svg>
        </div>
    </div>
    <script>
        // Add zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 10]) // Set the zoom scale extent
            .on('zoom', zoomed);

        function zoomed(event) {
            d3.select('.zoomable').attr('transform', event.transform);
        }
        const diagram = d3.select('#diagram');
        diagram.call(zoom);


        // Select all nodes and make them draggable
        const nodes = d3.selectAll('.nodes g');

        function getNodePositions() {
            const positions = {};
            nodes.each(function () {
                const node = d3.select(this);
                const transform = node.attr('transform');
                const translate = transform.match(/translate\(([^, ]+)[, ]+([^)]+)\)/);
                if (translate) {
                    const x = parseFloat(translate[1]);
                    const y = parseFloat(translate[2]);
                    positions[node.attr('id')] = { x, y };
                }
            });
            console.log(positions);
            return positions;
        }

        // Store the initial positions of the nodes
        const nodePositions = getNodePositions();

        function getEdgeSourceAndTarget(edgeId) {
            // First find the id of the last : character and get the substring after it
            const byParts = edgeId.split(':');
            let rel = byParts[byParts.length - 1];

            const [sourceId, targetId] = rel.split('->');
            return { sourceId, targetId };
        }

        function updatePath(path, startX, startY, endX, endY) {
            const controlPoint1 = `${(startX + endX) / 2},${startY}`;
            const controlPoint2 = `${(startX + endX) / 2},${endY}`;
            const newD = `M${startX},${startY} C${controlPoint1},${controlPoint2},${endX},${endY}`;
            path.attr('d', newD);
        }

        function getIntersectionPoint(node, targetNode) {
            const dx = targetNode.x - node.x;
            const dy = targetNode.y - node.y;
            const absDx = Math.abs(dx);
            const absDy = Math.abs(dy);

            let x = node.x;
            let y = node.y;

            const halfWidth = 50;
            const halfHeight = 30;

            if (absDx > absDy) {
                x += dx > 0 ? halfWidth : -halfWidth;
                y += dy * (halfWidth / absDx);
            } else {
                x += dx * (halfHeight / absDy);
                y += dy > 0 ? halfHeight : -halfHeight;
            }

            return { x, y };
        }

        function updateEdges(nodeId) {
            const node = nodePositions[nodeId];
            // Update edges where the node is the source
            d3.selectAll(`g[id*=":${nodeId}->"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (sourceId === nodeId);

                const targetNode = nodePositions[targetId];
                const sourceIntersection = getIntersectionPoint(node, targetNode);
                const targetIntersection = getIntersectionPoint(targetNode, node);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });

            // Update edges where the node is the target
            d3.selectAll(`g[id*="->${nodeId}"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (targetId === nodeId);

                const sourceNode = nodePositions[sourceId];
                const sourceIntersection = getIntersectionPoint(sourceNode, node);
                const targetIntersection = getIntersectionPoint(node, sourceNode);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });
        }

        nodes
            .call(d3.drag()
                .on('start', dragStarted)
                .on('drag', dragged)
                .on('end', dragEnded));

        function dragStarted(event, d) {
            d3.select(this).raise().attr('stroke', 'black');
        }

        function dragged(event, d) {
            const nodeId = d3.select(this).attr('id');
            nodePositions[nodeId].x = event.x;
            nodePositions[nodeId].y = event.y;
            d3.select(this).attr('transform', `translate(${event.x}, ${event.y})`);
            updateEdges(nodeId); // Update the edges during the drag event
        }

        function dragEnded(event, d) {
            d3.select(this).attr('stroke', null);
        }



        /**** This bit ensures we zoom to fit ***/
        const bbox = d3.select('.zoomable').node().getBBox();
        const padding = 10; // Padding in pixels

        const viewBox = [
            bbox.x - padding,
            bbox.y - padding,
            bbox.width + 2 * padding,
            bbox.height + 2 * padding
        ].join(' ');


        const topSvg = d3.select("#diagram");
        topSvg.attr('viewBox', viewBox);
        /*************************************/

    </script>
</body>

</html>