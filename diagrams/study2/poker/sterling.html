<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Zoomable Image</title>
    <style>
        #svg-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #zoomable-image {
            width: 100%;
            height: auto;
        }

        .svg-border {
            border: 2px solid black;
        }
    </style>
    <!-- Include D3.js library -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>

    <div class="container">


        <div class="container-fluid" id="svg-container">
            <svg id="diagram" width="800" height="800" class="svg-border">
                <g class="zoomable">

                        <g
                            transform="matrix(0.7651343538409493,0,0,0.7651343538409493,201.2876309099146,-121.3850765380713)">
                            <g id="">
                                <defs>
                                    <marker id="arrow-10-[#333]" viewBox="0 0 10 10" refX="0" refY="5" markerWidth="10"
                                        markerHeight="10" markerUnits="userSpaceOnUse" orient="auto" fill="#333">
                                        <path d="M 0 0 L 10 5 L 0 10 z"></path>
                                    </marker>
                                </defs>
                                <g class="nodes">
                                    <g id="Player0" transform="translate(10 -480)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player0</text>
                                    </g>
                                    <g id="Player1" transform="translate(100 -160)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player1</text>
                                    </g>
                                    <g id="Player2" transform="translate(100 320)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player2</text>
                                    </g>
                                    <g id="Player3" transform="translate(100 160)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player3</text>
                                    </g>
                                    <g id="Player4" transform="translate(0 480)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player4</text>
                                    </g>
                                    <g id="Player5" transform="translate(100 0)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player5</text>
                                    </g>
                                    <g id="Player6" transform="translate(10 -320)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player6</text>
                                    </g>
                                    <g id="Dealer0" transform="translate(-100 -160)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Dealer0</text>
                                    </g>
                                </g>
                                <g class="edges">
                                    <g id="Player<:holding:Player6->Dealer0">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M-31.249999999999964,-290L-42.70833333333331,-281.6666666666667C-54.16666666666665,-273.3333333333333,-77.08333333333333,-256.6666666666667,-88.54119110107422,-241.66666666666666C-99.99904886881511,-226.66666666666666,-99.9980977376302,-213.33333333333334,-99.99762217203777,-206.66666666666666L-99.99714660644531,-200">
                                        </path>
                                        <path
                                            d="M-31.249999999999964,-290L-42.70833333333331,-281.6666666666667C-54.16666666666665,-273.3333333333333,-77.08333333333333,-256.6666666666667,-88.54166666666667,-240C-100,-223.33333333333334,-100,-206.66666666666666,-100,-198.33333333333334L-100,-190"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-80.9891357421875" y="-249.3743438720703" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">holding</text>
                                    </g>
                                    <g id="Player<:left:Player0->Player6">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M-40,-454.19354838709677L-57.5,-445.16129032258067C-75,-436.12903225806457,-110,-418.06451612903226,-111.48103459676106,-400.764405281313C-112.96206919352214,-383.46429443359375,-80.92413838704427,-366.9285888671875,-64.90517298380534,-358.6607360839844L-48.886207580566406,-350.39288330078125">
                                        </path>
                                        <path
                                            d="M-40,-454.19354838709677L-57.5,-445.16129032258067C-75,-436.12903225806457,-110,-418.06451612903226,-110,-400C-110,-381.93548387096774,-75,-363.87096774193543,-57.5,-354.83870967741933L-40,-345.80645161290323"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="-110"
                                            y="-400" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player1->Player5">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M50,-132.41379310344826L34.166666666666664,-123.67816091954022C18.333333333333332,-114.94252873563217,-13.333333333333334,-97.47126436781609,-14.79262924194336,-80.80512897447608C-16.251925150553387,-64.13899358113606,12.496149698893229,-48.27798716227213,26.870187123616535,-40.34748395284017L41.244224548339844,-32.4169807434082">
                                        </path>
                                        <path
                                            d="M50,-132.41379310344826L34.166666666666664,-123.67816091954022C18.333333333333332,-114.94252873563217,-13.333333333333334,-97.47126436781609,-13.333333333333334,-80C-13.333333333333334,-62.5287356321839,18.333333333333332,-45.05747126436781,34.166666666666664,-36.32183908045977L50,-27.586206896551722"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-13.333333015441895" y="-80" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player2->Player4">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M50,332.1212121212121L3.3333333333333335,343.4343434343434C-43.333333333333336,354.74747474747477,-136.66666666666666,377.37373737373736,-154.90749486287436,398.57411640822284C-173.14832305908203,419.7744954427083,-116.29664611816406,439.5489908854167,-87.87080764770508,449.4362386067708L-59.444969177246094,459.323486328125">
                                        </path>
                                        <path
                                            d="M50,332.1212121212121L3.3333333333333335,343.4343434343434C-43.333333333333336,354.74747474747477,-136.66666666666666,377.37373737373736,-153.33333333333334,399.12165129556433C-170,420.8695652173913,-110,441.7391304347827,-80,452.1739130434783L-50,462.60869565217394"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-117.49131774902344" y="378.2423095703125" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player3->Player2">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M50,187.58620689655174L34.166666666666664,196.32183908045977C18.333333333333332,205.05747126436782,-13.333333333333334,222.52873563218392,-14.792629877726236,239.19486911817526C-16.25192642211914,255.86100260416666,12.496147155761719,271.7220052083333,26.87018394470215,279.6525065104167L41.24422073364258,287.5830078125">
                                        </path>
                                        <path
                                            d="M50,187.58620689655174L34.166666666666664,196.32183908045977C18.333333333333332,205.05747126436782,-13.333333333333334,222.52873563218392,-13.333333333333334,240C-13.333333333333334,257.4712643678161,18.333333333333332,274.94252873563215,34.166666666666664,283.67816091954023L50,292.41379310344826"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-13.333333015441895" y="240" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player4->Player0">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M50,460.9523809523809L76.66666666666667,450.7936507936508C103.33333333333333,440.63492063492066,156.66666666666666,420.3174603174603,183.33333333333334,396.8253968253968C210,373.3333333333333,210,346.6666666666667,210,320C210,293.3333333333333,210,266.6666666666667,210,240C210,213.33333333333334,210,186.66666666666666,210,160C210,133.33333333333334,210,106.66666666666667,210,80C210,53.333333333333336,210,26.666666666666668,210,0C210,-26.666666666666668,210,-53.333333333333336,210,-80C210,-106.66666666666667,210,-133.33333333333334,210,-160C210,-186.66666666666666,210,-213.33333333333334,210,-240C210,-266.6666666666667,210,-293.3333333333333,210,-320C210,-346.6666666666667,210,-373.3333333333333,186.54746119181314,-396.0476837158203C163.0949223836263,-418.7620340983073,116.18984476725261,-437.52406819661456,92.73730595906575,-446.90508524576825L69.2847671508789,-456.2861022949219">
                                        </path>
                                        <path
                                            d="M50,460.9523809523809L76.66666666666667,450.7936507936508C103.33333333333333,440.63492063492066,156.66666666666666,420.3174603174603,183.33333333333334,396.8253968253968C210,373.3333333333333,210,346.6666666666667,210,320C210,293.3333333333333,210,266.6666666666667,210,240C210,213.33333333333334,210,186.66666666666666,210,160C210,133.33333333333334,210,106.66666666666667,210,80C210,53.333333333333336,210,26.666666666666668,210,0C210,-26.666666666666668,210,-53.333333333333336,210,-80C210,-106.66666666666667,210,-133.33333333333334,210,-160C210,-186.66666666666666,210,-213.33333333333334,210,-240C210,-266.6666666666667,210,-293.3333333333333,210,-320C210,-346.6666666666667,210,-373.3333333333333,185,-396.6666666666667C160,-420,110,-440,85,-450L60,-460"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="210"
                                            y="4.38885498046875" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player5->Player3">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M50,27.586206896551737L34.166666666666664,36.32183908045978C18.333333333333332,45.05747126436783,-13.333333333333334,62.52873563218392,-14.792629877726236,79.19487038974104C-16.25192642211914,95.86100514729817,12.496147155761719,111.72201029459636,26.87018394470215,119.65251286824544L41.24422073364258,127.58301544189453">
                                        </path>
                                        <path
                                            d="M50,27.586206896551737L34.166666666666664,36.32183908045978C18.333333333333332,45.05747126436783,-13.333333333333334,62.52873563218392,-13.333333333333334,80C-13.333333333333334,97.47126436781609,18.333333333333332,114.9425287356322,34.166666666666664,123.67816091954023L50,132.41379310344828"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-13.333333015441895" y="80.00001525878906" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player6->Player1">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M10,-290L10,-281.6666666666667C10,-273.3333333333333,10,-256.6666666666667,18.12931760152181,-241.10727183024088C26.25863520304362,-225.5478769938151,42.51727040608724,-211.09575398763022,50.64658800760905,-203.86969248453775L58.77590560913086,-196.6436309814453">
                                        </path>
                                        <path
                                            d="M10,-290L10,-281.6666666666667C10,-273.3333333333333,10,-256.6666666666667,19.374999999999996,-240C28.749999999999996,-223.33333333333334,47.49999999999999,-206.66666666666666,56.87499999999999,-198.33333333333334L66.24999999999999,-190"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="24.0261287689209" y="-232.72109985351562" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:right:Player0->Player4">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M-40,-461.8181818181818L-68.33333333333333,-451.5151515151515C-96.66666666666667,-441.2121212121212,-153.33333333333334,-420.60606060606057,-181.66666666666666,-396.969696969697C-210,-373.3333333333333,-210,-346.6666666666667,-210,-320C-210,-293.3333333333333,-210,-266.6666666666667,-210,-240C-210,-213.33333333333334,-210,-186.66666666666666,-210,-160C-210,-133.33333333333334,-210,-106.66666666666667,-210,-80C-210,-53.333333333333336,-210,-26.666666666666668,-210,0C-210,26.666666666666668,-210,53.333333333333336,-210,80C-210,106.66666666666667,-210,133.33333333333334,-210,160C-210,186.66666666666666,-210,213.33333333333334,-210,240C-210,266.6666666666667,-210,293.3333333333333,-210,320C-210,346.6666666666667,-210,373.3333333333333,-184.89081255594888,396.23207092285156C-159.7816251118978,419.1308085123698,-109.56325022379558,438.26161702473956,-84.45406277974446,447.8270212809245L-59.34487533569336,457.3924255371094">
                                        </path>
                                        <path
                                            d="M-40,-461.8181818181818L-68.33333333333333,-451.5151515151515C-96.66666666666667,-441.2121212121212,-153.33333333333334,-420.60606060606057,-181.66666666666666,-396.969696969697C-210,-373.3333333333333,-210,-346.6666666666667,-210,-320C-210,-293.3333333333333,-210,-266.6666666666667,-210,-240C-210,-213.33333333333334,-210,-186.66666666666666,-210,-160C-210,-133.33333333333334,-210,-106.66666666666667,-210,-80C-210,-53.333333333333336,-210,-26.666666666666668,-210,0C-210,26.666666666666668,-210,53.333333333333336,-210,80C-210,106.66666666666667,-210,133.33333333333334,-210,160C-210,186.66666666666666,-210,213.33333333333334,-210,240C-210,266.6666666666667,-210,293.3333333333333,-210,320C-210,346.6666666666667,-210,373.3333333333333,-183.33333333333334,396.8253968253968C-156.66666666666666,420.3174603174603,-103.33333333333333,440.63492063492066,-76.66666666666667,450.7936507936508L-50,460.95238095238096"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="-210"
                                            y="-4.41131591796875" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player1->Player6">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M116.87499999999999,-190L121.56249999999999,-198.33333333333334C126.25,-206.66666666666666,135.625,-223.33333333333334,127.57965342203777,-239.2120564778646C119.53430684407552,-255.09077962239584,94.06861368815105,-270.1815592447917,81.3357671101888,-277.72694905598956L68.60292053222656,-285.2723388671875">
                                        </path>
                                        <path
                                            d="M116.87499999999999,-190L121.56249999999999,-198.33333333333334C126.25,-206.66666666666666,135.625,-223.33333333333334,126.14583333333333,-240.06172839506175C116.66666666666667,-256.7901234567901,88.33333333333333,-273.58024691358025,74.16666666666667,-281.97530864197535L60,-290.3703703703704"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="116.74398803710938" y="-251.77919006347656" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player2->Player3">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M116.87499999999999,290L121.56249999999999,281.6666666666667C126.25,273.3333333333333,135.625,256.6666666666667,136.44208526611328,241.4526341756185C137.25917053222656,226.2386016845703,129.51834106445312,212.47720336914062,125.6479263305664,205.59650421142578L121.77751159667969,198.71580505371094">
                                        </path>
                                        <path
                                            d="M116.87499999999999,290L121.56249999999999,281.6666666666667C126.25,273.3333333333333,135.625,256.6666666666667,135.625,240C135.625,223.33333333333334,126.25,206.66666666666666,121.5625,198.33333333333334L116.875,190"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="135.625"
                                            y="240" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player3->Player5">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M116.875,130L121.5625,121.66666666666667C126.25,113.33333333333333,135.625,96.66666666666667,136.44208526611328,81.45263544718425C137.25917053222656,66.23860422770183,129.51834106445312,52.47720845540365,125.6479263305664,45.596510569254555L121.77751159667969,38.71581268310547">
                                        </path>
                                        <path
                                            d="M116.875,130L121.5625,121.66666666666667C126.25,113.33333333333333,135.625,96.66666666666667,135.625,80C135.625,63.333333333333336,126.25,46.666666666666664,121.5625,38.333333333333336L116.875,30"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="135.625"
                                            y="80" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player4->Player2">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M50,462.6086956521739L80,452.17391304347825C110,441.73913043478257,170,420.8695652173913,187.8777643839518,402.9749437415082C205.75552876790366,385.080322265625,181.51105753580728,370.16064453125,169.38882191975912,362.7008056640625L157.26658630371094,355.240966796875">
                                        </path>
                                        <path
                                            d="M50,462.6086956521739L80,452.17391304347825C110,441.73913043478257,170,420.8695652173913,186.45833333333334,402.1014492753623C202.91666666666666,383.3333333333333,175.83333333333334,366.6666666666667,162.29166666666666,358.3333333333333L148.75,350"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="154.8173828125" y="422.7817687988281" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player5->Player1">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M116.875,-30L121.5625,-38.333333333333336C126.25,-46.666666666666664,135.625,-63.333333333333336,136.44208399454752,-78.54736455281575C137.25916798909506,-93.76139577229817,129.5183359781901,-107.52279154459636,125.64791997273763,-114.40348943074544L121.77750396728516,-121.28418731689453">
                                        </path>
                                        <path
                                            d="M116.875,-30L121.5625,-38.333333333333336C126.25,-46.666666666666664,135.625,-63.333333333333336,135.625,-80C135.625,-96.66666666666667,126.25,-113.33333333333333,121.5625,-121.66666666666667L116.875,-130"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="135.625"
                                            y="-80.00000762939453" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player6->Player0">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M60,-349.6296296296297L74.16666666666667,-358.0246913580247C88.33333333333333,-366.4197530864198,116.66666666666667,-383.2098765432099,118.1004867553711,-399.15032808280284C119.53430684407552,-415.0907796223958,94.06861368815105,-430.1815592447917,81.3357671101888,-437.72694905598956L68.60292053222656,-445.2723388671875">
                                        </path>
                                        <path
                                            d="M60,-349.6296296296297L74.16666666666667,-358.0246913580247C88.33333333333333,-366.4197530864198,116.66666666666667,-383.2098765432099,116.66666666666667,-400C116.66666666666667,-416.7901234567901,88.33333333333333,-433.5802469135803,74.16666666666667,-441.97530864197535L60,-450.3703703703704"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="116.66666412353516" y="-400" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                </g>
                            </g>
                        </g>

                </g>
            </svg>
        </div>
    </div>
    <script>
        // Add zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 10]) // Set the zoom scale extent
            .on('zoom', zoomed);

        function zoomed(event) {
            d3.select('.zoomable').attr('transform', event.transform);
        }
        const diagram = d3.select('#diagram');
        diagram.call(zoom);


        // Select all nodes and make them draggable
        const nodes = d3.selectAll('.nodes g');

        function getNodePositions() {
            const positions = {};
            nodes.each(function () {
                const node = d3.select(this);
                const transform = node.attr('transform');
                const translate = transform.match(/translate\(([^, ]+)[, ]+([^)]+)\)/);
                if (translate) {
                    const x = parseFloat(translate[1]);
                    const y = parseFloat(translate[2]);
                    positions[node.attr('id')] = { x, y };
                }
            });
            console.log(positions);
            return positions;
        }

        // Store the initial positions of the nodes
        const nodePositions = getNodePositions();

        function getEdgeSourceAndTarget(edgeId) {
            // First find the id of the last : character and get the substring after it
            const byParts = edgeId.split(':');
            let rel = byParts[byParts.length - 1];

            const [sourceId, targetId] = rel.split('->');
            return { sourceId, targetId };
        }

        function updatePath(path, startX, startY, endX, endY) {
            const controlPoint1 = `${(startX + endX) / 2},${startY}`;
            const controlPoint2 = `${(startX + endX) / 2},${endY}`;
            const newD = `M${startX},${startY} C${controlPoint1},${controlPoint2},${endX},${endY}`;
            path.attr('d', newD);
        }

        function getIntersectionPoint(node, targetNode) {
            const dx = targetNode.x - node.x;
            const dy = targetNode.y - node.y;
            const absDx = Math.abs(dx);
            const absDy = Math.abs(dy);

            let x = node.x;
            let y = node.y;

            const halfWidth = 50;
            const halfHeight = 30;

            if (absDx > absDy) {
                x += dx > 0 ? halfWidth : -halfWidth;
                y += dy * (halfWidth / absDx);
            } else {
                x += dx * (halfHeight / absDy);
                y += dy > 0 ? halfHeight : -halfHeight;
            }

            return { x, y };
        }

        function updateEdges(nodeId) {
            const node = nodePositions[nodeId];
            // Update edges where the node is the source
            d3.selectAll(`g[id*=":${nodeId}->"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (sourceId === nodeId);

                const targetNode = nodePositions[targetId];
                const sourceIntersection = getIntersectionPoint(node, targetNode);
                const targetIntersection = getIntersectionPoint(targetNode, node);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });

            // Update edges where the node is the target
            d3.selectAll(`g[id*="->${nodeId}"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (targetId === nodeId);

                const sourceNode = nodePositions[sourceId];
                const sourceIntersection = getIntersectionPoint(sourceNode, node);
                const targetIntersection = getIntersectionPoint(node, sourceNode);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });
        }

        nodes
            .call(d3.drag()
                .on('start', dragStarted)
                .on('drag', dragged)
                .on('end', dragEnded));

        function dragStarted(event, d) {
            d3.select(this).raise().attr('stroke', 'black');
        }

        function dragged(event, d) {
            const nodeId = d3.select(this).attr('id');
            nodePositions[nodeId].x = event.x;
            nodePositions[nodeId].y = event.y;
            d3.select(this).attr('transform', `translate(${event.x}, ${event.y})`);
            updateEdges(nodeId); // Update the edges during the drag event
        }

        function dragEnded(event, d) {
            d3.select(this).attr('stroke', null);
        }



        /**** This bit ensures we zoom to fit ***/
        const bbox = d3.select('.zoomable').node().getBBox();
        const padding = 10; // Padding in pixels

        const viewBox = [
            bbox.x - padding,
            bbox.y - padding,
            bbox.width + 2 * padding,
            bbox.height + 2 * padding
        ].join(' ');


        const topSvg = d3.select("#diagram");
        topSvg.attr('viewBox', viewBox);
        /*************************************/

    </script>
</body>

</html>