<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Zoomable Image</title>
    <style>
        #svg-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #zoomable-image {
            width: 100%;
            height: auto;
        }

        .svg-border {
            border: 2px solid black;
        }
    </style>
    <!-- Include D3.js library -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>

    <div class="container">


        <div class="container-fluid" id="svg-container">
            <svg id="diagram" width="800" height="800" class="svg-border">
                <g class="zoomable">

                        <g
                            transform="matrix(0.9478672985781991,0,0,0.9478672985781991,13.450236966824633,-7.090047393364927)">
                            <g id="">
                                <defs>
                                    <marker id="arrow-10-[#333]" viewBox="0 0 10 10" refX="0" refY="5" markerWidth="10"
                                        markerHeight="10" markerUnits="userSpaceOnUse" orient="auto" fill="#333">
                                        <path d="M 0 0 L 10 5 L 0 10 z"></path>
                                    </marker>
                                </defs>
                                <g class="nodes">
                                    <g id="Card0" transform="translate(-12.5 400)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Card0</text>
                                    </g>
                                    <g id="Card1" transform="translate(-47.5 240)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Card1</text>
                                    </g>
                                    <g id="Card2" transform="translate(-187.5 80)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Card2</text>
                                    </g>
                                    <g id="Card3" transform="translate(-187.5 -80)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Card3</text>
                                    </g>
                                    <g id="Card4" transform="translate(-187.5 -240)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Card4</text>
                                    </g>
                                    <g id="Player0" transform="translate(37.5 -400)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player0</text>
                                    </g>
                                    <g id="Player1" transform="translate(12.5 -240)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player1</text>
                                    </g>
                                    <g id="Player2" transform="translate(12.5 -80)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player2</text>
                                    </g>
                                    <g id="Player3" transform="translate(12.5 80)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player3</text>
                                    </g>
                                    <g id="Player4" transform="translate(152.5 240)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Player4</text>
                                    </g>
                                    <g id="Dealer0" transform="translate(187.5 400)">
                                        <rect x="-50" y="-30" width="100" height="60"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: rgb(255, 255, 255);">
                                        </rect><text x="0" y="0" dy="0.33em"
                                            style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Dealer0</text>
                                    </g>
                                </g>
                                <g class="edges">
                                    <g id="Player<:left:Player0->Player1">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M-5.624999999999959,-370L-17.604166666666632,-361.6666666666667C-29.583333333333304,-353.3333333333333,-53.54166666666666,-336.6666666666667,-57.3915147781372,-321.1072743733724C-61.24136288960775,-305.5478820800781,-44.98272577921549,-291.09576416015625,-36.85340722401937,-283.8697052001953L-28.724088668823242,-276.6436462402344">
                                        </path>
                                        <path
                                            d="M-5.624999999999959,-370L-17.604166666666632,-361.6666666666667C-29.583333333333304,-353.3333333333333,-53.54166666666666,-336.6666666666667,-56.14583333333332,-320C-58.75000000000001,-303.3333333333333,-40.00000000000001,-286.6666666666667,-30.625000000000014,-278.3333333333333L-21.250000000000018,-270"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-54.95136260986328" y="-324.485107421875" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player1->Player2">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M5.000000000000007,-210L2.9166666666666727,-201.66666666666666C0.833333333333338,-193.33333333333334,-3.333333333333331,-176.66666666666666,-3.7374276717503854,-161.61693700154623C-4.1415220101674395,-146.56720733642578,-0.7830440203348795,-133.13441467285156,0.8961949745814005,-126.41801834106445L2.5754339694976807,-119.70162200927734">
                                        </path>
                                        <path
                                            d="M5.000000000000007,-210L2.9166666666666727,-201.66666666666666C0.833333333333338,-193.33333333333334,-3.333333333333331,-176.66666666666666,-3.3333333333333335,-160C-3.3333333333333357,-143.33333333333334,0.8333333333333286,-126.66666666666667,2.9166666666666607,-118.33333333333333L4.999999999999993,-110"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-3.3333332538604736" y="-160" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player2->Player3">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M8.75,-50L7.708333333333333,-41.666666666666664C6.666666666666667,-33.333333333333336,4.583333333333333,-16.666666666666668,4.376688877741496,-1.6538060506184895C4.170044422149658,13.359054565429688,5.840088844299316,26.718109130859375,6.6751110553741455,33.39763641357422L7.510133266448975,40.07716369628906">
                                        </path>
                                        <path
                                            d="M8.75,-50L7.708333333333333,-41.666666666666664C6.666666666666667,-33.333333333333336,4.583333333333333,-16.666666666666668,4.583333333333331,0C4.583333333333329,16.666666666666668,6.666666666666657,33.333333333333336,7.7083333333333215,41.666666666666664L8.749999999999986,50"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="4.583333492279053" y="0.000003814697265625" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player3->Player4">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M12.5,110L12.5,118.33333333333333C12.5,126.66666666666667,12.5,143.33333333333334,26.052927652994793,159.41119639078775C39.605855305989586,175.4890594482422,66.71171061197917,190.97811889648438,80.26463826497395,198.72264862060547L93.81756591796875,206.46717834472656">
                                        </path>
                                        <path
                                            d="M12.5,110L12.5,118.33333333333333C12.5,126.66666666666667,12.5,143.33333333333334,27.5,160.23809523809524C42.5,177.14285714285714,72.5,194.2857142857143,87.5,202.8571428571429L102.5,211.42857142857144"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="41.12173843383789" y="172.845947265625" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:left:Player4->Player0">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M148.75,210L147.70833333333334,201.66666666666666C146.66666666666666,193.33333333333334,144.58333333333334,176.66666666666666,143.54166666666666,155C142.5,133.33333333333334,142.5,106.66666666666667,142.5,80C142.5,53.333333333333336,142.5,26.666666666666668,142.5,0C142.5,-26.666666666666668,142.5,-53.333333333333336,142.5,-80C142.5,-106.66666666666667,142.5,-133.33333333333334,142.5,-160C142.5,-186.66666666666666,142.5,-213.33333333333334,142.5,-240C142.5,-266.6666666666667,142.5,-293.3333333333333,132.88821919759116,-313.98992919921875C123.2764383951823,-334.6465250651042,104.05287679036458,-349.2930501302083,94.44109598795573,-356.61631266276044L84.82931518554688,-363.9395751953125">
                                        </path>
                                        <path
                                            d="M148.75,210L147.70833333333334,201.66666666666666C146.66666666666666,193.33333333333334,144.58333333333334,176.66666666666666,143.54166666666666,155C142.5,133.33333333333334,142.5,106.66666666666667,142.5,80C142.5,53.333333333333336,142.5,26.666666666666668,142.5,0C142.5,-26.666666666666668,142.5,-53.333333333333336,142.5,-80C142.5,-106.66666666666667,142.5,-133.33333333333334,142.5,-160C142.5,-186.66666666666666,142.5,-213.33333333333334,142.5,-240C142.5,-266.6666666666667,142.5,-293.3333333333333,131.5625,-315C120.625,-336.6666666666667,98.75,-353.3333333333333,87.8125,-361.6666666666667L76.875,-370"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="142.5"
                                            y="-92.25167846679688" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                    </g>
                                    <g id="Player<:right:Player0->Player4">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M69.37500000000001,-370L78.22916666666667,-361.6666666666667C87.08333333333333,-353.3333333333333,104.79166666666667,-336.6666666666667,113.64583333333333,-315C122.5,-293.3333333333333,122.5,-266.6666666666667,122.5,-240C122.5,-213.33333333333334,122.5,-186.66666666666666,122.5,-160C122.5,-133.33333333333334,122.5,-106.66666666666667,122.5,-80C122.5,-53.333333333333336,122.5,-26.666666666666668,122.5,0C122.5,26.666666666666668,122.5,53.333333333333336,122.5,80C122.5,106.66666666666667,122.5,133.33333333333334,125.03990681966145,153.43941497802734C127.57981363932292,173.54549662272134,132.65962727864584,187.09099324544272,135.19953409830728,193.86374155680338L137.73944091796875,200.63648986816406">
                                        </path>
                                        <path
                                            d="M69.37500000000001,-370L78.22916666666667,-361.6666666666667C87.08333333333333,-353.3333333333333,104.79166666666667,-336.6666666666667,113.64583333333333,-315C122.5,-293.3333333333333,122.5,-266.6666666666667,122.5,-240C122.5,-213.33333333333334,122.5,-186.66666666666666,122.5,-160C122.5,-133.33333333333334,122.5,-106.66666666666667,122.5,-80C122.5,-53.333333333333336,122.5,-26.666666666666668,122.5,0C122.5,26.666666666666668,122.5,53.333333333333336,122.5,80C122.5,106.66666666666667,122.5,133.33333333333334,125.625,155C128.75,176.66666666666666,135,193.33333333333334,138.125,201.66666666666666L141.25,210"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="122.5"
                                            y="-87.38430786132812" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player1->Player0">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M29.374999999999986,-270L34.06249999999999,-278.3333333333333C38.74999999999999,-286.6666666666667,48.125,-303.3333333333333,51.133178075154625,-318.38304138183594C54.14135615030924,-333.43274943033856,50.78271230061849,-346.86549886067706,49.10339037577311,-353.5818735758464L47.424068450927734,-360.2982482910156">
                                        </path>
                                        <path
                                            d="M29.374999999999986,-270L34.06249999999999,-278.3333333333333C38.74999999999999,-286.6666666666667,48.125,-303.3333333333333,50.729166666666664,-320C53.333333333333336,-336.6666666666667,49.166666666666664,-353.3333333333333,47.08333333333334,-361.6666666666667L45.00000000000001,-370"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="50.393001556396484" y="-318.0437927246094" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player2->Player1">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M29.374999999999986,-110L34.06249999999999,-118.33333333333333C38.74999999999999,-126.66666666666667,48.125,-143.33333333333334,48.94208526611328,-158.5473658243815C49.75917053222656,-173.7613983154297,42.018341064453125,-187.52279663085938,38.147926330566406,-194.40349578857422L34.27751159667969,-201.28419494628906">
                                        </path>
                                        <path
                                            d="M29.374999999999986,-110L34.06249999999999,-118.33333333333333C38.74999999999999,-126.66666666666667,48.125,-143.33333333333334,48.125,-160C48.125,-176.66666666666666,38.75,-193.33333333333334,34.0625,-201.66666666666666L29.375,-210"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="48.125"
                                            y="-160.00001525878906" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player3->Player2">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M29.375,50L34.0625,41.666666666666664C38.75,33.333333333333336,48.125,16.666666666666668,48.94208526611328,1.4526354471842449C49.75917053222656,-13.761395772298178,42.018341064453125,-27.522791544596355,38.147926330566406,-34.403489430745445L34.27751159667969,-41.28418731689453">
                                        </path>
                                        <path
                                            d="M29.375,50L34.0625,41.666666666666664C38.75,33.333333333333336,48.125,16.666666666666668,48.125,0C48.125,-16.666666666666668,38.75,-33.333333333333336,34.0625,-41.666666666666664L29.375,-50"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text x="48.125"
                                            y="0.0000038146949918882456" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:right:Player4->Player3">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M156.25,210L157.29166666666666,201.66666666666666C158.33333333333334,193.33333333333334,160.41666666666666,176.66666666666666,146.2622553507487,160.22875849405924C132.10784403483072,143.7908503214518,101.71568806966145,127.58170064290364,86.51961008707683,119.47712580362956L71.32353210449219,111.37255096435547">
                                        </path>
                                        <path
                                            d="M156.25,210L157.29166666666666,201.66666666666666C158.33333333333334,193.33333333333334,160.41666666666666,176.66666666666666,144.79166666666666,159.44444444444443C129.16666666666666,142.2222222222222,95.83333333333333,124.44444444444441,79.16666666666667,115.55555555555553L62.5,106.66666666666664"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="128.18626403808594" y="145.00303649902344" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">right</text>
                                    </g>
                                    <g id="Player<:hand:Player0->Card4">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M-12.5,-382.2222222222222L-41.666666666666664,-371.8518518518518C-70.83333333333333,-361.48148148148147,-129.16666666666666,-340.7407407407407,-158.33212534586588,-323.7036986174407C-187.4975840250651,-306.6666564941406,-187.49516805013022,-293.33331298828125,-187.49396006266275,-286.66664123535156L-187.4927520751953,-279.9999694824219">
                                        </path>
                                        <path
                                            d="M-12.5,-382.2222222222222L-41.666666666666664,-371.8518518518518C-70.83333333333333,-361.48148148148147,-129.16666666666666,-340.7407407407407,-158.33333333333334,-322.037037037037C-187.5,-303.3333333333333,-187.5,-286.6666666666667,-187.5,-278.3333333333333L-187.5,-270"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-116.20782470703125" y="-343.3201599121094" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">hand</text>
                                    </g>
                                    <g id="Player<:hand:Player1->Card3">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M-37.5,-220L-62.5,-210C-87.5,-200,-137.5,-180,-162.49896494547525,-163.3333282470703C-187.49792989095053,-146.66665649414062,-187.49585978190103,-133.33331298828125,-187.4948247273763,-126.66664123535156L-187.49378967285156,-119.99996948242188">
                                        </path>
                                        <path
                                            d="M-37.5,-220L-62.5,-210C-87.5,-200,-137.5,-180,-162.5,-161.66666666666666C-187.5,-143.33333333333334,-187.5,-126.66666666666667,-187.5,-118.33333333333333L-187.5,-110"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-128.9782257080078" y="-181.14208984375" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">hand</text>
                                    </g>
                                    <g id="Player<:hand:Player2->Card2">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M-37.5,-59.99999999999999L-62.5,-49.99999999999999C-87.5,-39.99999999999999,-137.5,-19.999999999999996,-162.49896748860678,-3.3333295186360665C-187.49793497721353,13.333340962727865,-187.4958699544271,26.66668192545573,-187.49483744303384,33.333352406819664L-187.49380493164062,40.000022888183594">
                                        </path>
                                        <path
                                            d="M-37.5,-59.99999999999999L-62.5,-49.99999999999999C-87.5,-39.99999999999999,-137.5,-19.999999999999996,-162.5,-1.6666666666666654C-187.5,16.666666666666668,-187.5,33.333333333333336,-187.5,41.666666666666664L-187.5,50"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-128.9781951904297" y="-21.14209747314453" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">hand</text>
                                    </g>
                                    <g id="Player<:hand:Player3->Card1">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M-9.999999999999993,110L-16.249999999999996,118.33333333333333C-22.499999999999996,126.66666666666667,-35,143.33333333333334,-41.24973996480306,158.33333333333334C-47.49947992960612,173.33333333333334,-47.49895985921224,186.66666666666666,-47.4986998240153,193.33333333333334L-47.49843978881836,200">
                                        </path>
                                        <path
                                            d="M-9.999999999999993,110L-16.249999999999996,118.33333333333333C-22.499999999999996,126.66666666666667,-35,143.33333333333334,-41.25,160C-47.5,176.66666666666666,-47.50000000000001,193.33333333333334,-47.50000000000001,201.66666666666666L-47.500000000000014,210"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="-39.667449951171875" y="156.076416015625" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">hand</text>
                                    </g>
                                    <g id="Player<:hand:Player4->Card0">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M102.5,264.24242424242425L83.33333333333333,273.5353535353535C64.16666666666667,282.82828282828285,25.833333333333332,301.4141414141414,6.667460282643636,317.3737424600004C-12.49841276804606,333.3333435058594,-12.496825536092123,346.66668701171875,-12.496031920115152,353.33335876464844L-12.495238304138184,360.0000305175781">
                                        </path>
                                        <path
                                            d="M102.5,264.24242424242425L83.33333333333333,273.5353535353535C64.16666666666667,282.82828282828285,25.833333333333332,301.4141414141414,6.666666666666664,319.04040404040404C-12.500000000000005,336.6666666666667,-12.500000000000009,353.3333333333333,-12.500000000000012,361.6666666666667L-12.500000000000014,370"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="28.366199493408203" y="302.9984130859375" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">hand</text>
                                    </g>
                                    <g id="Player<:holding:Player4->Dealer0">
                                        <path marker-end="url(#arrow-10-[#333])"
                                            style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                            d="M165.625,270L169.27083333333334,278.3333333333333C172.91666666666666,286.6666666666667,180.20833333333334,303.3333333333333,183.85401662190756,318.3333333333333C187.49969991048178,333.3333333333333,187.49939982096353,346.6666666666667,187.49924977620444,353.3333333333333L187.4990997314453,360">
                                        </path>
                                        <path
                                            d="M165.625,270L169.27083333333334,278.3333333333333C172.91666666666666,286.6666666666667,180.20833333333334,303.3333333333333,183.85416666666666,320C187.5,336.6666666666667,187.5,353.3333333333333,187.5,361.6666666666667L187.5,370"
                                            stroke="transparent" stroke-width="11" fill="none"></path><text
                                            x="183.51686096191406" y="318.5025939941406" dy="0.33em"
                                            style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">holding</text>
                                    </g>
                                </g>
                            </g>
                        </g>


                </g>
            </svg>
        </div>
    </div>
    <script>
        // Add zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 10]) // Set the zoom scale extent
            .on('zoom', zoomed);

        function zoomed(event) {
            d3.select('.zoomable').attr('transform', event.transform);
        }
        const diagram = d3.select('#diagram');
        diagram.call(zoom);


        // Select all nodes and make them draggable
        const nodes = d3.selectAll('.nodes g');

        function getNodePositions() {
            const positions = {};
            nodes.each(function () {
                const node = d3.select(this);
                const transform = node.attr('transform');
                const translate = transform.match(/translate\(([^, ]+)[, ]+([^)]+)\)/);
                if (translate) {
                    const x = parseFloat(translate[1]);
                    const y = parseFloat(translate[2]);
                    positions[node.attr('id')] = { x, y };
                }
            });
            console.log(positions);
            return positions;
        }

        // Store the initial positions of the nodes
        const nodePositions = getNodePositions();

        function getEdgeSourceAndTarget(edgeId) {
            // First find the id of the last : character and get the substring after it
            const byParts = edgeId.split(':');
            let rel = byParts[byParts.length - 1];

            const [sourceId, targetId] = rel.split('->');
            return { sourceId, targetId };
        }

        function updatePath(path, startX, startY, endX, endY) {
            const controlPoint1 = `${(startX + endX) / 2},${startY}`;
            const controlPoint2 = `${(startX + endX) / 2},${endY}`;
            const newD = `M${startX},${startY} C${controlPoint1},${controlPoint2},${endX},${endY}`;
            path.attr('d', newD);
        }

        function getIntersectionPoint(node, targetNode) {
            const dx = targetNode.x - node.x;
            const dy = targetNode.y - node.y;
            const absDx = Math.abs(dx);
            const absDy = Math.abs(dy);

            let x = node.x;
            let y = node.y;

            const halfWidth = 50;
            const halfHeight = 30;

            if (absDx > absDy) {
                x += dx > 0 ? halfWidth : -halfWidth;
                y += dy * (halfWidth / absDx);
            } else {
                x += dx * (halfHeight / absDy);
                y += dy > 0 ? halfHeight : -halfHeight;
            }

            return { x, y };
        }

        function updateEdges(nodeId) {
            const node = nodePositions[nodeId];
            // Update edges where the node is the source
            d3.selectAll(`g[id*=":${nodeId}->"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (sourceId === nodeId);

                const targetNode = nodePositions[targetId];
                const sourceIntersection = getIntersectionPoint(node, targetNode);
                const targetIntersection = getIntersectionPoint(targetNode, node);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });

            // Update edges where the node is the target
            d3.selectAll(`g[id*="->${nodeId}"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (targetId === nodeId);

                const sourceNode = nodePositions[sourceId];
                const sourceIntersection = getIntersectionPoint(sourceNode, node);
                const targetIntersection = getIntersectionPoint(node, sourceNode);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });
        }

        nodes
            .call(d3.drag()
                .on('start', dragStarted)
                .on('drag', dragged)
                .on('end', dragEnded));

        function dragStarted(event, d) {
            d3.select(this).raise().attr('stroke', 'black');
        }

        function dragged(event, d) {
            const nodeId = d3.select(this).attr('id');
            nodePositions[nodeId].x = event.x;
            nodePositions[nodeId].y = event.y;
            d3.select(this).attr('transform', `translate(${event.x}, ${event.y})`);
            updateEdges(nodeId); // Update the edges during the drag event
        }

        function dragEnded(event, d) {
            d3.select(this).attr('stroke', null);
        }



        /**** This bit ensures we zoom to fit ***/
        const bbox = d3.select('.zoomable').node().getBBox();
        const padding = 10; // Padding in pixels

        const viewBox = [
            bbox.x - padding,
            bbox.y - padding,
            bbox.width + 2 * padding,
            bbox.height + 2 * padding
        ].join(' ');


        const topSvg = d3.select("#diagram");
        topSvg.attr('viewBox', viewBox);
        /*************************************/

    </script>
</body>

</html>