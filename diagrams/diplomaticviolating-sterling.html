<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Zoomable Image</title>
    <style>
        #svg-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #zoomable-image {
            width: 100%;
            height: auto;
        }

        .svg-border {
            border: 2px solid black;
        }
    </style>
    <!-- Include D3.js library -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>

    <div class="container">


        <div class="container-fluid" id="svg-container">
            <svg id="diagram" width="800" height="800" class="svg-border">
                <g class="zoomable">
                    <g
                        transform="matrix(0.8516136641838226,0,0,0.8516136641838226,41.21269700618414,-36.65671889648752)">
                        <g id="">
                            <defs>
                                <marker id="arrow-10-[#333]" viewBox="0 0 10 10" refX="0" refY="5" markerWidth="10"
                                    markerHeight="10" markerUnits="userSpaceOnUse" orient="auto" fill="#333">
                                    <path d="M 0 0 L 10 5 L 0 10 z"></path>
                                </marker>
                            </defs>
                            <g class="nodes">
                                <g id="Host0" transform="translate(55 -720)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(34, 222, 236); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Host0</text>
                                </g>
                                <g id="Host1" transform="translate(-100 -80)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(34, 222, 236); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Host1</text>
                                </g>
                                <g id="Host2" transform="translate(0 -400)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(34, 222, 236); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Host2</text>
                                </g>
                                <g id="Host3" transform="translate(-100 400)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(34, 222, 236); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Host3</text>
                                </g>
                                <g id="Host4" transform="translate(55 720)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(34, 222, 236); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Host4</text>
                                </g>
                                <g id="Microphone0" transform="translate(100 -80)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(74, 131, 17); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Microphone0</text>
                                </g>
                                <g id="Visitor0" transform="translate(-100 560)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(231, 46, 255); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Visitor0</text>
                                </g>
                                <g id="Visitor1" transform="translate(-100 240)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(231, 46, 255); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Visitor1</text>
                                </g>
                                <g id="Visitor2" transform="translate(0 -560)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(231, 46, 255); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Visitor2</text>
                                </g>
                                <g id="Visitor3" transform="translate(-100 80)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(231, 46, 255); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Visitor3</text>
                                </g>
                                <g id="Visitor4" transform="translate(0 -240)">
                                    <rect x="-50" y="-30" width="100" height="60"
                                        style="stroke: rgb(231, 46, 255); stroke-width: 1; fill: rgb(255, 255, 255);">
                                    </rect><text x="0" y="0" dy="0.33em"
                                        style="font-family: monospace; font-size: 14px; text-anchor: middle; user-select: none; fill: rgb(51, 51, 51);">Visitor4</text>
                                </g>
                            </g>
                            <g class="edges">
                                <g id="Person<:holding:Visitor4->Microphone0">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M37.50000000000003,-210L47.916666666666686,-201.66666666666666C58.33333333333335,-193.33333333333334,79.16666666666667,-176.66666666666666,89.58290227254231,-161.66666666666666C99.99913787841797,-146.66666666666666,99.99827575683594,-133.33333333333334,99.99784469604492,-126.66666666666667L99.9974136352539,-120">
                                    </path>
                                    <path
                                        d="M37.50000000000003,-210L47.916666666666686,-201.66666666666666C58.33333333333335,-193.33333333333334,79.16666666666667,-176.66666666666666,89.58333333333333,-160C100,-143.33333333333334,100,-126.66666666666667,100,-118.33333333333333L100,-110"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="83.55482482910156" y="-168.354248046875" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">holding</text>
                                </g>
                                <g id="Person<:left:Visitor0->Host4">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-100,590L-100,598.3333333333334C-100,606.6666666666666,-100,623.3333333333334,-83.98103555043538,639.9345194498698C-67.96207110087077,656.5357055664062,-35.92414220174154,673.0714111328125,-19.90517775217692,681.3392639160156L-3.8862133026123047,689.6071166992188">
                                    </path>
                                    <path
                                        d="M-100,590L-100,598.3333333333334C-100,606.6666666666666,-100,623.3333333333334,-82.5,640.6989247311827C-65,658.0645161290323,-30,676.1290322580645,-12.5,685.1612903225806L5,694.1935483870968"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-64.08568572998047" y="655.4896850585938" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                </g>
                                <g id="Person<:left:Visitor1->Host3">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-100,270L-100,278.3333333333333C-100,286.6666666666667,-100,303.3333333333333,-100,318.3333333333333C-100,333.3333333333333,-100,346.6666666666667,-100,353.3333333333333L-100,360">
                                    </path>
                                    <path
                                        d="M-100,270L-100,278.3333333333333C-100,286.6666666666667,-100,303.3333333333333,-100,320C-100,336.6666666666667,-100,353.3333333333333,-100,361.6666666666667L-100,370"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="-100" y="320"
                                        dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                </g>
                                <g id="Person<:left:Visitor2->Host2">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M0,-530L0,-521.6666666666666C0,-513.3333333333334,0,-496.6666666666667,1.2141975721154571e-8,-481.6666666666667C2.4283951442309142e-8,-466.6666666666667,4.8567902884618284e-8,-453.3333333333333,6.070987860577286e-8,-446.6666666666667L7.285185432692742e-8,-440">
                                    </path>
                                    <path
                                        d="M0,-530L0,-521.6666666666666C0,-513.3333333333334,0,-496.6666666666667,-2.3684757858670005e-15,-480C-4.736951571734001e-15,-463.3333333333333,-9.473903143468002e-15,-446.6666666666667,-1.1842378929335004e-14,-438.3333333333333L-1.4210854715202004e-14,-430"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-2.3684758564530796e-15" y="-480" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                </g>
                                <g id="Person<:left:Visitor3->Visitor1">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-100,110L-100,118.33333333333333C-100,126.66666666666667,-100,143.33333333333334,-100,158.33333333333334C-100,173.33333333333334,-100,186.66666666666666,-100,193.33333333333334L-100,200">
                                    </path>
                                    <path
                                        d="M-100,110L-100,118.33333333333333C-100,126.66666666666667,-100,143.33333333333334,-100,160C-100,176.66666666666666,-100,193.33333333333334,-100,201.66666666666666L-100,210"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="-100" y="160"
                                        dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                </g>
                                <g id="Person<:left:Visitor4->Host1">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-37.499999999999986,-210L-47.91666666666666,-201.66666666666666C-58.33333333333332,-193.33333333333334,-79.16666666666667,-176.66666666666666,-89.58290227254231,-161.66666666666666C-99.99913787841797,-146.66666666666666,-99.99827575683594,-133.33333333333334,-99.99784469604492,-126.66666666666667L-99.9974136352539,-120">
                                    </path>
                                    <path
                                        d="M-37.499999999999986,-210L-47.91666666666666,-201.66666666666666C-58.33333333333332,-193.33333333333334,-79.16666666666667,-176.66666666666666,-89.58333333333333,-160C-100,-143.33333333333334,-100,-126.66666666666667,-100,-118.33333333333333L-100,-110"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-83.55482482910156" y="-168.354248046875" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                </g>
                                <g id="Person<:left:Host0->Visitor2">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M34.375,-690L28.645833333333332,-681.6666666666666C22.916666666666668,-673.3333333333334,11.458333333333334,-656.6666666666666,5.729405052416648,-641.6666666666666C0.0004767714999616146,-626.6666666666666,0.0009535429999232292,-613.3333333333334,0.0011919287499040365,-606.6666666666666L0.0014303144998848438,-600">
                                    </path>
                                    <path
                                        d="M34.375,-690L28.645833333333332,-681.6666666666666C22.916666666666668,-673.3333333333334,11.458333333333334,-656.6666666666666,5.729166666666664,-640C-4.736951571734001e-15,-623.3333333333334,-9.473903143468002e-15,-606.6666666666666,-1.1842378929335004e-14,-598.3333333333334L-1.4210854715202004e-14,-590"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="6.969843864440918" y="-643.38671875" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                </g>
                                <g id="Person<:left:Host1->Visitor3">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-100,-50L-100,-41.666666666666664C-100,-33.333333333333336,-100,-16.666666666666668,-100,-1.6666673024495442C-100,13.333332061767578,-100,26.666664123535156,-100,33.333330154418945L-100,39.999996185302734">
                                    </path>
                                    <path
                                        d="M-100,-50L-100,-41.666666666666664C-100,-33.333333333333336,-100,-16.666666666666668,-100,0C-100,16.666666666666668,-100,33.333333333333336,-100,41.666666666666664L-100,50"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="-100" y="0"
                                        dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                </g>
                                <g id="Person<:left:Host2->Visitor4">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M0,-370L0,-361.6666666666667C0,-353.3333333333333,0,-336.6666666666667,1.2141975721154571e-8,-321.6666666666667C2.4283951442309142e-8,-306.6666666666667,4.8567902884618284e-8,-293.3333333333333,6.070987860577286e-8,-286.6666666666667L7.285185432692742e-8,-280">
                                    </path>
                                    <path
                                        d="M0,-370L0,-361.6666666666667C0,-353.3333333333333,0,-336.6666666666667,-2.3684757858670005e-15,-320C-4.736951571734001e-15,-303.3333333333333,-9.473903143468002e-15,-286.6666666666667,-1.1842378929335004e-14,-278.3333333333333L-1.4210854715202004e-14,-270"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text
                                        x="-2.3684758564530796e-15" y="-320" dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                </g>
                                <g id="Person<:left:Host3->Visitor0">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M-100,430L-100,438.3333333333333C-100,446.6666666666667,-100,463.3333333333333,-100,478.3333333333333C-100,493.3333333333333,-100,506.6666666666667,-100,513.3333333333334L-100,520">
                                    </path>
                                    <path
                                        d="M-100,430L-100,438.3333333333333C-100,446.6666666666667,-100,463.3333333333333,-100,480C-100,496.6666666666667,-100,513.3333333333334,-100,521.6666666666666L-100,530"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="-100" y="480"
                                        dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                </g>
                                <g id="Person<:left:Host4->Host0">
                                    <path marker-end="url(#arrow-10-[#333])"
                                        style="stroke: rgb(51, 51, 51); stroke-width: 1; fill: none;"
                                        d="M105,694.1935483870968L122.5,685.1612903225806C140,676.1290322580645,175,658.0645161290323,192.5,635.6989247311827C210,613.3333333333334,210,586.6666666666666,210,560C210,533.3333333333334,210,506.6666666666667,210,480C210,453.3333333333333,210,426.6666666666667,210,400C210,373.3333333333333,210,346.6666666666667,210,320C210,293.3333333333333,210,266.6666666666667,210,240C210,213.33333333333334,210,186.66666666666666,210,160C210,133.33333333333334,210,106.66666666666667,210,80C210,53.333333333333336,210,26.666666666666668,210,0C210,-26.666666666666668,210,-53.333333333333336,210,-80C210,-106.66666666666667,210,-133.33333333333334,210,-160C210,-186.66666666666666,210,-213.33333333333334,210,-240C210,-266.6666666666667,210,-293.3333333333333,210,-320C210,-346.6666666666667,210,-373.3333333333333,210,-400C210,-426.6666666666667,210,-453.3333333333333,210,-480C210,-506.6666666666667,210,-533.3333333333334,210,-560C210,-586.6666666666666,210,-613.3333333333334,193.9810358683268,-634.9345194498698C177.96207173665366,-656.5357055664062,145.92414347330728,-673.0714111328125,129.90517934163412,-681.3392639160156L113.88621520996094,-689.6071166992188">
                                    </path>
                                    <path
                                        d="M105,694.1935483870968L122.5,685.1612903225806C140,676.1290322580645,175,658.0645161290323,192.5,635.6989247311827C210,613.3333333333334,210,586.6666666666666,210,560C210,533.3333333333334,210,506.6666666666667,210,480C210,453.3333333333333,210,426.6666666666667,210,400C210,373.3333333333333,210,346.6666666666667,210,320C210,293.3333333333333,210,266.6666666666667,210,240C210,213.33333333333334,210,186.66666666666666,210,160C210,133.33333333333334,210,106.66666666666667,210,80C210,53.333333333333336,210,26.666666666666668,210,0C210,-26.666666666666668,210,-53.333333333333336,210,-80C210,-106.66666666666667,210,-133.33333333333334,210,-160C210,-186.66666666666666,210,-213.33333333333334,210,-240C210,-266.6666666666667,210,-293.3333333333333,210,-320C210,-346.6666666666667,210,-373.3333333333333,210,-400C210,-426.6666666666667,210,-453.3333333333333,210,-480C210,-506.6666666666667,210,-533.3333333333334,210,-560C210,-586.6666666666666,210,-613.3333333333334,192.5,-635.6989247311827C175,-658.0645161290323,140,-676.1290322580645,122.5,-685.1612903225806L105,-694.1935483870968"
                                        stroke="transparent" stroke-width="11" fill="none"></path><text x="210" y="0"
                                        dy="0.33em"
                                        style="font-family: monospace; font-size: 12px; text-anchor: middle; user-select: none;">left</text>
                                </g>
                            </g>
                        </g>
                    </g>

                </g>
            </svg>
        </div>
    </div>
    <script>
        // Add zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 10]) // Set the zoom scale extent
            .on('zoom', zoomed);

        function zoomed(event) {
            d3.select('.zoomable').attr('transform', event.transform);
        }
        const diagram = d3.select('#diagram');
        diagram.call(zoom);


        // Select all nodes and make them draggable
        const nodes = d3.selectAll('.nodes g');

        function getNodePositions() {
            const positions = {};
            nodes.each(function () {
                const node = d3.select(this);
                const transform = node.attr('transform');
                const translate = transform.match(/translate\(([^, ]+)[, ]+([^)]+)\)/);
                if (translate) {
                    const x = parseFloat(translate[1]);
                    const y = parseFloat(translate[2]);
                    positions[node.attr('id')] = { x, y };
                }
            });
            console.log(positions);
            return positions;
        }

        // Store the initial positions of the nodes
        const nodePositions = getNodePositions();

        function getEdgeSourceAndTarget(edgeId) {
            // First find the id of the last : character and get the substring after it
            const byParts = edgeId.split(':');
            let rel = byParts[byParts.length - 1];

            const [sourceId, targetId] = rel.split('->');
            return { sourceId, targetId };
        }

        function updatePath(path, startX, startY, endX, endY) {
            const controlPoint1 = `${(startX + endX) / 2},${startY}`;
            const controlPoint2 = `${(startX + endX) / 2},${endY}`;
            const newD = `M${startX},${startY} C${controlPoint1},${controlPoint2},${endX},${endY}`;
            path.attr('d', newD);
        }

        function getIntersectionPoint(node, targetNode) {
            const dx = targetNode.x - node.x;
            const dy = targetNode.y - node.y;
            const absDx = Math.abs(dx);
            const absDy = Math.abs(dy);

            let x = node.x;
            let y = node.y;

            const halfWidth = 50;
            const halfHeight = 30;

            if (absDx > absDy) {
                x += dx > 0 ? halfWidth : -halfWidth;
                y += dy * (halfWidth / absDx);
            } else {
                x += dx * (halfHeight / absDy);
                y += dy > 0 ? halfHeight : -halfHeight;
            }

            return { x, y };
        }

        function updateEdges(nodeId) {
            const node = nodePositions[nodeId];
            // Update edges where the node is the source
            d3.selectAll(`g[id*=":${nodeId}->"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (sourceId === nodeId);

                const targetNode = nodePositions[targetId];
                const sourceIntersection = getIntersectionPoint(node, targetNode);
                const targetIntersection = getIntersectionPoint(targetNode, node);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });

            // Update edges where the node is the target
            d3.selectAll(`g[id*="->${nodeId}"]`).each(function () {
                const edge = d3.select(this);
                const edgeId = edge.attr('id');

                const { sourceId, targetId } = getEdgeSourceAndTarget(edgeId);
                //assert (targetId === nodeId);

                const sourceNode = nodePositions[sourceId];
                const sourceIntersection = getIntersectionPoint(sourceNode, node);
                const targetIntersection = getIntersectionPoint(node, sourceNode);
                edge.select('path').each(function () {
                    updatePath(d3.select(this), sourceIntersection.x, sourceIntersection.y, targetIntersection.x, targetIntersection.y);
                });

                // Update the position of the label
                edge.select('text').attr('x', (sourceIntersection.x + targetIntersection.x) / 2)
                    .attr('y', (sourceIntersection.y + targetIntersection.y) / 2);
            });
        }

        nodes
            .call(d3.drag()
                .on('start', dragStarted)
                .on('drag', dragged)
                .on('end', dragEnded));

        function dragStarted(event, d) {
            d3.select(this).raise().attr('stroke', 'black');
        }

        function dragged(event, d) {
            const nodeId = d3.select(this).attr('id');
            nodePositions[nodeId].x = event.x;
            nodePositions[nodeId].y = event.y;
            d3.select(this).attr('transform', `translate(${event.x}, ${event.y})`);
            updateEdges(nodeId); // Update the edges during the drag event
        }

        function dragEnded(event, d) {
            d3.select(this).attr('stroke', null);
        }



        /**** This bit ensures we zoom to fit ***/
        const bbox = d3.select('.zoomable').node().getBBox();
        const padding = 10; // Padding in pixels

        const viewBox = [
            bbox.x - padding,
            bbox.y - padding,
            bbox.width + 2 * padding,
            bbox.height + 2 * padding
        ].join(' ');


        const topSvg = d3.select("#diagram");
        topSvg.attr('viewBox', viewBox);
        /*************************************/

    </script>
</body>

</html>